<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wealth Management Platform</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #e2e8f0; /* Light track for light mode */
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e0; /* Slightly darker thumb */
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #a0aec0;
        }

        .dark ::-webkit-scrollbar-track {
            background: #2d3748; /* Darker track for dark mode */
        }
        .dark ::-webkit-scrollbar-thumb {
            background: #4a5568; /* Even darker thumb */
        }
        .dark ::-webkit-scrollbar-thumb:hover {
            background: #6b7280;
        }

        /* Dark mode specific styles */
        .dark .bg-gray-100 { background-color: #1a202c; }
        .dark .text-gray-900 { color: #edf2f7; }
        .dark .bg-white { background-color: #2d3748; }
        .dark .text-gray-700 { color: #a0aec0; }
        .dark .text-gray-600 { color: #718096; }
        .dark .border-gray-200 { border-color: #4a5568; }
        .dark .shadow-md { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.2), 0 2px 4px -1px rgba(0, 0, 0, 0.12); }
        .dark .hover\:bg-blue-100:hover { background-color: #2a4365; }
        .dark .hover\:text-blue-700:hover { color: #63b3ed; }
        .dark .bg-blue-500 { background-color: #4299e1; }
        .dark .hover\:bg-blue-600:hover { background-color: #3182ce; }
        .dark .bg-gray-50 { background-color: #2d3748; }
        .dark .text-gray-500 { color: #a0aec0; }
        .dark .border-b { border-color: #4a5568; }
        .dark .text-gray-800 { color: #e2e8f0; }
        .dark .bg-gray-200 { background-color: #4a5568; }
        .dark .text-blue-600 { color: #63b3ed; }
        .dark .bg-blue-100 { background-color: #2a4365; }
        .dark .text-green-500 { color: #68d391; }
        .dark .text-red-500 { color: #fc8181; }
        .dark .text-yellow-500 { color: #f6ad55; }
        .dark .text-purple-500 { color: #b794f4; }
        .dark .bg-green-600 { background-color: #38a169; }
        .dark .bg-yellow-500 { background-color: #d69e2e; }
        .dark .bg-indigo-600 { background-color: #667eea; }
        .dark .hover\:text-blue-800:hover { color: #4299e1; }
        .dark .text-gray-300 { color: #d1d5db; } /* Added for better text contrast */
        .dark .text-gray-100 { color: #f3f4f6; } /* Added for better heading contrast */

        /* Chart.js specific dark mode adjustments */
        .dark canvas {
            background-color: #2d3748 !important; /* Ensure chart background adapts */
        }

        /* Tooltip styles */
        .tooltip-container {
            position: relative;
            display: inline-block;
        }

        .tooltip-text {
            visibility: hidden;
            width: 160px;
            background-color: rgba(0, 0, 0, 0.7);
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px 0;
            position: absolute;
            z-index: 10;
            bottom: 125%; /* Position above the icon */
            left: 50%;
            margin-left: -80px; /* Center the tooltip */
            opacity: 0;
            transition: opacity 0.3s;
        }

        .tooltip-text::after {
            content: "";
            position: absolute;
            top: 100%; /* At the bottom of the tooltip */
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: rgba(0, 0, 0, 0.7) transparent transparent transparent;
        }

        .tooltip-container:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        .dark .tooltip-text {
            background-color: rgba(255, 255, 255, 0.2); /* Lighter background for dark mode tooltip */
            color: #fff;
        }

        .dark .tooltip-text::after {
            border-color: rgba(255, 255, 255, 0.2) transparent transparent transparent;
        }

        /* Product card icon styling */
        .product-action-icon {
            @apply text-gray-500 dark:text-gray-400 hover:text-blue-500 dark:hover:text-blue-400 transition-colors duration-200 cursor-pointer;
        }

        /* Adjusted product card padding to be more compact */
        .product-card {
            padding: 1rem; /* Reduced from p-5 to p-4 */
            height: 200px; /* Fixed height for compactness */
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .product-card .content-area {
            flex-grow: 1; /* Allows content to take available space */
            overflow: hidden; /* Hide overflow description */
        }
        .product-card .actions-area {
            flex-shrink: 0; /* Prevents actions from shrinking */
            padding-top: 0.5rem; /* Small padding above buttons */
        }

        /* Filter button styling */
        .filter-button.active {
            @apply bg-blue-500 text-white dark:bg-blue-600 dark:text-gray-100;
        }

        /* Custom gauge chart styles for risk score */
        .gauge-chart-container {
            position: relative;
            width: 150px;
            height: 75px; /* Half circle */
            overflow: hidden;
            margin: 0 auto;
        }

        .gauge-chart-arc {
            position: absolute;
            top: 0;
            left: 0;
            width: 150px;
            height: 150px; /* Full circle */
            border-radius: 50%;
            border: 15px solid;
            border-color: #e2e8f0 #e2e8f0 #e2e8f0 #e2e8f0; /* Light mode default */
            box-sizing: border-box;
            transform: rotate(45deg); /* Align the start point */
        }

        .dark .gauge-chart-arc {
            border-color: #4a5568 #4a5568 #4a5568 #4a5568; /* Dark mode default */
        }

        .gauge-chart-value-arc {
            position: absolute;
            top: 0;
            left: 0;
            width: 150px;
            height: 150px;
            border-radius: 50%;
            border: 15px solid transparent;
            box-sizing: border-box;
            transform: rotate(45deg);
            transition: border-color 0.5s ease-in-out;
        }

        .gauge-chart-needle {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform-origin: bottom center;
            width: 2px;
            height: 65px; /* Length of the needle */
            background-color: #ef4444; /* Red color for needle */
            border-radius: 2px;
            transition: transform 0.5s ease-in-out;
            z-index: 1;
        }

        .gauge-chart-center-dot {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 10px;
            height: 10px;
            background-color: #ef4444;
            border-radius: 50%;
            z-index: 2;
        }

        .gauge-chart-label {
            position: absolute;
            bottom: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.875rem; /* text-sm */
            font-weight: 600; /* font-semibold */
            color: #374151; /* gray-700 */
            width: 100%;
            text-align: center;
        }

        .dark .gauge-chart-label {
            color: #d1d5db; /* gray-300 */
        }

        /* Modal specific styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            width: 90%;
            max-width: 500px;
            position: relative;
        }

        .dark .modal-content {
            background-color: #2d3748;
            color: #edf2f7;
        }

        /* Notification panel styles */
        .notification-panel {
            position: absolute;
            top: 60px; /* Adjust based on header height */
            right: 0;
            width: 300px;
            background-color: white;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 999;
            transform: translateX(100%);
            opacity: 0;
            visibility: hidden;
            transition: transform 0.3s ease-out, opacity 0.3s ease-out, visibility 0.3s ease-out;
        }

        .notification-panel.open {
            transform: translateX(0);
            opacity: 1;
            visibility: visible;
        }

        .dark .notification-panel {
            background-color: #2d3748;
            border-color: #4a5568;
        }
    </style>
</head>
<body class="bg-gray-100 flex h-screen text-gray-900 overflow-hidden transition-colors duration-300">

    <!-- Sidebar Navigation -->
    <aside class="w-64 bg-white dark:bg-gray-900 shadow-md flex flex-col p-6 rounded-r-lg transition-colors duration-300">
        <div class="flex items-center mb-8">
            <i class="fas fa-wallet text-blue-500 text-3xl mr-3"></i>
            <h1 class="text-2xl font-bold text-gray-800 dark:text-gray-100">WealthPro</h1>
        </div>
        <nav class="flex-grow">
            <ul class="space-y-3">
                <li>
                    <a href="#" class="nav-link flex items-center p-3 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-blue-100 hover:text-blue-700 transition-colors duration-200" data-target="dashboard-view">
                        <i class="fas fa-chart-line mr-3 text-lg"></i>
                        <span>Dashboard</span>
                    </a>
                </li>
                <li>
                    <a href="#" class="nav-link flex items-center p-3 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-blue-100 hover:text-blue-700 transition-colors duration-200" data-target="clients-list-view">
                        <i class="fas fa-users mr-3 text-lg"></i>
                        <span>Clients</span>
                    </a>
                </li>
                <li>
                    <a href="#" class="nav-link flex items-center p-3 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-blue-100 hover:text-blue-700 transition-colors duration-200" data-target="products-view">
                        <i class="fas fa-box-open mr-3 text-lg"></i>
                        <span>Products</span>
                    </a>
                </li>
                <li>
                    <a href="#" class="nav-link flex items-center p-3 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-blue-100 hover:text-blue-700 transition-colors duration-200" data-target="reports-view">
                        <i class="fas fa-file-alt mr-3 text-lg"></i>
                        <span>Reports</span>
                    </a>
                </li>
                <li>
                    <a href="#" class="nav-link flex items-center p-3 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-blue-100 hover:text-blue-700 transition-colors duration-200" data-target="compliance-view">
                        <i class="fas fa-check-circle mr-3 text-lg"></i>
                        <span>Compliance</span>
                    </a>
                </li>
            </ul>
        </nav>
        <div class="mt-auto pt-5 border-t border-gray-200 dark:border-gray-600">
            <div class="flex items-center justify-between mb-3">
                <span class="text-sm text-gray-600 dark:text-gray-400">Dark Mode</span>
                <label for="dark-mode-toggle" class="relative inline-flex items-center cursor-pointer">
                    <input type="checkbox" id="dark-mode-toggle" class="sr-only peer">
                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border after:border-gray-300 after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div>
                </label>
            </div>
            <div class="flex items-center">
                <i class="fas fa-user-circle text-gray-500 dark:text-gray-400 text-2xl mr-2"></i>
                <span class="text-gray-700 dark:text-gray-300 font-medium">Jane Doe, WM</span>
            </div>
        </div>
    </aside>

    <!-- Main Content Area -->
    <main class="flex-grow p-6 overflow-y-auto custom-scrollbar bg-gray-100 dark:bg-gray-800">
        <!-- Top Bar for Main Content -->
        <header class="flex items-center justify-between pb-5 border-b border-gray-200 dark:border-gray-600 mb-6">
            <h2 id="page-title" class="text-3xl font-semibold text-gray-800 dark:text-gray-100">Dashboard</h2>
            <div class="flex items-center space-x-3 ml-auto">
                <!-- Notification Bell and Panel -->
                <div class="relative">
                    <button id="notification-bell" class="text-gray-700 dark:text-gray-300 text-2xl hover:text-blue-500 dark:hover:text-blue-400 transition-colors duration-200 relative">
                        <i class="fas fa-bell"></i>
                        <span id="notification-badge" class="absolute top-0 right-0 block h-3 w-3 rounded-full ring-2 ring-white dark:ring-gray-800 bg-red-500 text-white text-xs flex items-center justify-center"></span>
                    </button>
                    <div id="notification-panel" class="notification-panel p-4 border border-gray-200 dark:border-gray-600">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-semibold text-gray-800 dark:text-gray-100">Notifications</h4>
                            <button id="close-notification-panel" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <ul class="space-y-3 text-sm">
                            <li class="flex items-start text-gray-700 dark:text-gray-300">
                                <i class="fas fa-money-bill-wave text-green-500 mr-2 mt-1"></i>
                                <span>New cash inflow of <strong class="text-green-600">$100K</strong> received for Client X.</span>
                            </li>
                            <li class="flex items-start text-gray-700 dark:text-gray-300">
                                <i class="fas fa-exclamation-triangle text-red-500 mr-2 mt-1"></i>
                                <span><strong class="text-red-600">Risk limit breach</strong> in Account #1294.</span>
                            </li>
                            <li class="flex items-start text-gray-700 dark:text-gray-300">
                                <i class="fas fa-calendar-check text-yellow-500 mr-2 mt-1"></i>
                                <span><strong class="text-yellow-600">KYC due for renewal</strong> in 5 days for Client Y.</span>
                            </li>
                            <li class="flex items-start text-gray-700 dark:text-gray-300">
                                <i class="fas fa-chart-line text-blue-500 mr-2 mt-1"></i>
                                <span>Client Z's portfolio performance updated.</span>
                            </li>
                        </ul>
                    </div>
                </div>
                <span class="text-gray-700 dark:text-gray-300 font-medium">Jane Doe, WM</span>
                <button class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-colors duration-200 shadow-md text-sm">
                    <i class="fas fa-sign-out-alt mr-2"></i>Logout
                </button>
            </div>
        </header>

        <!-- Content Views (Initially show dashboard) -->
        <div id="dashboard-view" class="content-view active-view">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-3 gap-5 mb-6">
                <!-- KPI Card 1: Total AUM -->
                <div class="bg-white dark:bg-gray-700 p-5 rounded-lg shadow-md border border-gray-200 dark:border-gray-600 transition-colors duration-300 relative">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="text-base font-medium text-gray-700 dark:text-gray-300">Total AUM</h3>
                        <i class="fas fa-dollar-sign text-blue-500 text-lg"></i>
                    </div>
                    <p class="text-2xl font-bold text-gray-800 dark:text-gray-100">$1.25B</p>
                    <p class="text-xs text-green-500 mt-1"><i class="fas fa-arrow-up mr-1"></i>3.2% since last month</p>
                    <div class="absolute bottom-2 right-2 tooltip-container">
                        <i class="fas fa-info-circle text-gray-400 text-sm cursor-help"></i>
                        <span class="tooltip-text">Sum of all assets under management as of today.</span>
                    </div>
                </div>
                <!-- KPI Card 2: New Clients -->
                <div class="bg-white dark:bg-gray-700 p-5 rounded-lg shadow-md border border-gray-200 dark:border-gray-600 transition-colors duration-300 relative">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="text-base font-medium text-gray-700 dark:text-gray-300">New Clients (YTD)</h3>
                        <i class="fas fa-user-plus text-green-500 text-lg"></i>
                    </div>
                    <p class="text-2xl font-bold text-gray-800 dark:text-gray-100">45</p>
                    <p class="text-xs text-green-500 mt-1"><i class="fas fa-arrow-up mr-1"></i>15% increase</p>
                    <div class="absolute bottom-2 right-2 tooltip-container">
                        <i class="fas fa-info-circle text-gray-400 text-sm cursor-help"></i>
                        <span class="tooltip-text">Number of new clients acquired year-to-date.</span>
                    </div>
                </div>
                <!-- KPI Card 3: Revenue Contribution -->
                <div class="bg-white dark:bg-gray-700 p-5 rounded-lg shadow-md border border-gray-200 dark:border-gray-600 transition-colors duration-300 relative">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="text-base font-medium text-gray-700 dark:text-gray-300">Revenue (Q1)</h3>
                        <i class="fas fa-hand-holding-usd text-purple-500 text-lg"></i>
                    </div>
                    <p class="text-2xl font-bold text-gray-800 dark:text-gray-100">$12.8M</p>
                    <p class="text-xs text-yellow-500 mt-1"><i class="fas fa-minus mr-1"></i>0.5% below target</p>
                    <div class="absolute bottom-2 right-2 tooltip-container">
                        <i class="fas fa-info-circle text-gray-400 text-sm cursor-help"></i>
                        <span class="tooltip-text">Total revenue generated in the first quarter.</span>
                    </div>
                </div>
                <!-- KPI Card 4: Clients Needing Attention -->
                <button class="bg-white dark:bg-gray-700 p-5 rounded-lg shadow-md border border-gray-200 dark:border-gray-600 transition-colors duration-300 relative text-left" id="clients-attention-card">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="text-base font-medium text-gray-700 dark:text-gray-300">Clients Attention</h3>
                        <i class="fas fa-exclamation-triangle text-red-500 text-lg"></i>
                    </div>
                    <p class="text-2xl font-bold text-gray-800 dark:text-gray-100">7</p>
                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Pending reviews, low engagement</p>
                    <div class="absolute bottom-2 right-2 tooltip-container">
                        <i class="fas fa-info-circle text-gray-400 text-sm cursor-help"></i>
                        <span class="tooltip-text">Number of clients requiring immediate attention or follow-up. Click to view.</span>
                    </div>
                </button>
                <!-- KPI Card 5: Total Profitability -->
                <div class="bg-white dark:bg-gray-700 p-5 rounded-lg shadow-md border border-gray-200 dark:border-gray-600 transition-colors duration-300 relative">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="text-base font-medium text-gray-700 dark:text-gray-300">Total Profitability</h3>
                        <i class="fas fa-chart-line text-indigo-500 text-lg"></i>
                    </div>
                    <p class="text-2xl font-bold text-gray-800 dark:text-gray-100">$2.1M</p>
                    <p class="text-xs text-green-500 mt-1"><i class="fas fa-arrow-up mr-1"></i>+8.5% This Quarter</p>
                    <div class="absolute bottom-2 right-2 tooltip-container">
                        <i class="fas fa-info-circle text-gray-400 text-sm cursor-help"></i>
                        <span class="tooltip-text">Net gains across all client portfolios.</span>
                    </div>
                </div>
                <!-- KPI Card 6: Today's Cash Flow -->
                <div class="bg-white dark:bg-gray-700 p-5 rounded-lg shadow-md border border-gray-200 dark:border-gray-600 transition-colors duration-300 relative">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="text-base font-medium text-gray-700 dark:text-gray-300">Today's Cash Flow</h3>
                        <i class="fas fa-exchange-alt text-orange-500 text-lg"></i>
                    </div>
                    <p class="text-xl font-bold text-gray-800 dark:text-gray-100 flex items-center justify-between">
                        <span class="text-green-500"><i class="fas fa-arrow-up mr-1"></i>$50K In</span>
                        <span class="text-red-500"><i class="fas fa-arrow-down mr-1"></i>$15K Out</span>
                    </p>
                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Net: $35K</p>
                    <div class="absolute bottom-2 right-2 tooltip-container">
                        <i class="fas fa-info-circle text-gray-400 text-sm cursor-help"></i>
                        <span class="tooltip-text">Total cash inflows and outflows for the current day.</span>
                    </div>
                </div>
            </div>

            <!-- Dashboard Charts -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-5 mb-6">
                <!-- Portfolio Allocation Chart -->
                <div class="bg-white dark:bg-gray-700 p-5 rounded-lg shadow-md border border-gray-200 dark:border-gray-600 transition-colors duration-300">
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-100 mb-3">Portfolio Allocation</h3>
                    <div class="flex justify-end mb-3">
                        <select id="portfolio-allocation-filter" class="px-3 py-1 rounded-md border border-gray-300 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="none">Filter by...</option>
                            <option value="geography">Geography</option>
                            <option value="risk-categories">Risk Categories</option>
                            <option value="net-worth-tiers">Net Worth Tiers</option>
                            <option value="client-account-types">Client Account Types</option>
                        </select>
                    </div>
                    <div class="h-72">
                        <canvas id="portfolioAllocationChart"></canvas>
                    </div>
                </div>
                <!-- Asset Class Performance Chart -->
                <div class="bg-white dark:bg-gray-700 p-5 rounded-lg shadow-md border border-gray-200 dark:border-gray-600 transition-colors duration-300">
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-100 mb-3">Asset Class Performance (YTD)</h3>
                    <div class="h-72">
                        <canvas id="assetClassPerformanceChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-5 mb-6">
                <!-- Upcoming Activities Card -->
                <div class="bg-white dark:bg-gray-700 p-5 rounded-lg shadow-md border border-gray-200 dark:border-gray-600 transition-colors duration-300">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-100">Upcoming Schedule</h3>
                        <div class="flex rounded-full bg-gray-200 dark:bg-gray-600 p-1">
                            <button id="activities-toggle" class="px-3 py-1 text-sm font-medium rounded-full bg-blue-500 text-white dark:bg-blue-600 dark:text-gray-100 transition-colors duration-200">Activities</button>
                            <button id="events-toggle" class="px-3 py-1 text-sm font-medium rounded-full text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-500 transition-colors duration-200">Events</button>
                        </div>
                    </div>
                    
                    <!-- Activities Content -->
                    <ul id="activities-content" class="space-y-3">
                        <li class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg text-gray-900 dark:text-gray-200 text-sm">
                            <span><i class="fas fa-calendar-alt mr-2 text-blue-500"></i>Review with Mr. Al-Farsi</span>
                            <span class="text-gray-500 dark:text-gray-400">Tomorrow, 10:00 AM</span>
                        </li>
                        <li class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg text-gray-900 dark:text-gray-200 text-sm">
                            <span><i class="fas fa-phone mr-2 text-green-500"></i>Follow-up with Mrs. Khan</span>
                            <span class="text-gray-500 dark:text-gray-400">Wed, 2:00 PM</span>
                        </li>
                        <li class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg text-gray-900 dark:text-gray-200 text-sm">
                            <span><i class="fas fa-tasks mr-2 text-yellow-500"></i>Process Al-Mansoori's transfer</span>
                            <span class="text-gray-500 dark:text-gray-400">Due Friday</span>
                        </li>
                    </ul>

                    <!-- Events Content (hidden by default) -->
                    <ul id="events-content" class="space-y-3 hidden">
                        <li class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg text-gray-900 dark:text-gray-200 text-sm">
                            <span><i class="fas fa-birthday-cake mr-2 text-pink-500"></i>Birthday: Mr. Rashid Al-Ghaith</span>
                            <span class="text-gray-500 dark:text-gray-400">July 5th</span>
                        </li>
                        <li class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg text-gray-900 dark:text-gray-200 text-sm">
                            <span><i class="fas fa-gift mr-2 text-purple-500"></i>Anniversary: Mr. & Mrs. Ibrahim</span>
                            <span class="text-500 dark:text-gray-400">July 12th</span>
                        </li>
                        <li class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg text-gray-900 dark:text-gray-200 text-sm">
                            <span><i class="fas fa-bell mr-2 text-blue-500"></i>Custom Event: Q3 Strategy Meeting</span>
                            <span class="text-gray-500 dark:text-gray-400">August 1st</span>
                        </li>
                    </ul>
                </div>

                <!-- Top Clients Section -->
                <div class="bg-white dark:bg-gray-700 p-5 rounded-lg shadow-md border border-gray-200 dark:border-gray-600 transition-colors duration-300">
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-100 mb-4">Top Clients</h3>
                    <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-600 text-sm">
                        <thead class="bg-gray-50 dark:bg-gray-800">
                            <tr>
                                <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-400 cursor-pointer" data-sort-key="clientName">Client <i class="fas fa-sort text-gray-400 ml-1"></i></th>
                                <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-400 cursor-pointer" data-sort-key="aum">AUM <i class="fas fa-sort text-gray-400 ml-1"></i></th>
                                <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-400 cursor-pointer" data-sort-key="netFlows">Net Flows <i class="fas fa-sort text-gray-400 ml-1"></i></th>
                                <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-400 cursor-pointer" data-sort-key="performance">Perf. (%) <i class="fas fa-sort text-gray-400 ml-1"></i></th>
                                <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-400 cursor-pointer" data-sort-key="numAccounts">No. of Client Accounts <i class="fas fa-sort text-gray-400 ml-1"></i></th>
                            </tr>
                        </thead>
                        <tbody id="top-clients-table-body" class="bg-white dark:bg-gray-700 divide-y divide-gray-200 dark:divide-gray-600">
                            <!-- Top clients will be dynamically populated here -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Clients Attention Modal -->
            <div id="clients-attention-modal" class="modal-overlay hidden">
                <div class="modal-content dark:border dark:border-gray-600">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-semibold text-gray-800 dark:text-gray-100">Clients Needing Attention</h3>
                        <button id="close-attention-modal" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 text-lg">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <ul class="space-y-3 text-base text-gray-700 dark:text-gray-300">
                        <li class="p-2 bg-gray-50 dark:bg-gray-800 rounded-md">
                            <i class="fas fa-user-circle mr-2 text-blue-500"></i>Mr. John Doe - Low engagement (Last contact: 3 weeks ago)
                        </li>
                        <li class="p-2 bg-gray-50 dark:bg-gray-800 rounded-md">
                            <i class="fas fa-file-alt mr-2 text-yellow-500"></i>Mrs. Jane Smith - Pending annual review (Due: 2024-07-15)
                        </li>
                        <li class="p-2 bg-gray-50 dark:bg-gray-800 rounded-md">
                            <i class="fas fa-exclamation-circle mr-2 text-red-500"></i>Mr. Ali Hassan - Risk profile mismatch (Review required)
                        </li>
                    </ul>
                </div>
            </div>

        </div>

        <!-- Clients List View -->
        <div id="clients-list-view" class="content-view hidden">
            <h3 class="text-2xl font-semibold text-gray-800 dark:text-gray-100 mb-6">Your Clients</h3>
            <div class="bg-white dark:bg-gray-700 p-6 rounded-lg shadow-md border border-gray-200 dark:border-gray-600 transition-colors duration-300">
                <div class="mb-4 flex justify-between items-center">
                    <input type="text" placeholder="Search clients..." class="pl-4 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-800 dark:border-gray-600 text-gray-900 dark:text-gray-200 text-sm">
                    <button class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors duration-200 shadow-md text-sm">
                        <i class="fas fa-user-plus mr-2"></i>Add New Client
                    </button>
                </div>
                <div id="clients-table-container">
                    <!-- Client rows will be dynamically inserted here -->
                </div>
            </div>
        </div>

        <!-- Client 360 View (Dynamic Content) -->
        <div id="client-360-view" class="content-view hidden">
            <button class="text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-500 mb-4 flex items-center text-sm" onclick="showClientsList()">
                <i class="fas fa-arrow-left mr-2"></i>Back to Clients
            </button>
            <div id="client-360-header" class="bg-white dark:bg-gray-700 p-5 rounded-lg shadow-md border border-gray-200 dark:border-gray-600 mb-6 flex items-center space-x-5 transition-colors duration-300">
                <div class="w-20 h-20 bg-gray-200 dark:bg-gray-800 rounded-full flex items-center justify-center text-gray-500 dark:text-gray-400 text-3xl">
                    <i class="fas fa-user"></i>
                </div>
                <div>
                    <h3 id="client-name-display" class="text-2xl font-bold text-gray-800 dark:text-gray-100 mb-0.5">Client Name</h3>
                    <p id="client-aum-display" class="text-lg text-gray-700 dark:text-gray-300">AUM: $0</p>
                    <p id="client-rm-display" class="text-xs text-gray-500 dark:text-gray-400">RM: John Smith</p>
                </div>
                <div class="ml-auto flex space-x-3">
                    <button class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors duration-200 shadow-md text-sm">
                        <i class="fas fa-plus mr-2"></i>New Interaction
                    </button>
                    <button class="bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-200 px-4 py-2 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-700 transition-colors duration-200 shadow-md text-sm">
                        <i class="fas fa-file-alt mr-2"></i>Generate Report
                    </button>
                </div>
            </div>

            <div class="bg-white dark:bg-gray-700 p-5 rounded-lg shadow-md border border-gray-200 dark:border-gray-600 transition-colors duration-300">
                <!-- Client 360 Tabs -->
                <div class="border-b border-gray-200 dark:border-gray-600 mb-5">
                    <nav class="-mb-px flex space-x-6" aria-label="Tabs">
                        <button class="tab-button whitespace-nowrap py-2.5 px-1 border-b-2 font-medium text-sm border-blue-500 text-blue-600 dark:border-blue-400 dark:text-blue-400 active-tab" data-tab="overview">Overview</button>
                        <button class="tab-button whitespace-nowrap py-2.5 px-1 border-b-2 border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-500 font-medium text-sm" data-tab="portfolio">Portfolio</button>
                        <button class="tab-button whitespace-nowrap py-2.5 px-1 border-b-2 border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-500 font-medium text-sm" data-tab="interactions">Interactions</button>
                        <button class="tab-button whitespace-nowrap py-2.5 px-1 border-b-2 border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-500 font-medium text-sm" data-tab="goals">Goals & Advisory</button>
                        <button class="tab-button whitespace-nowrap py-2.5 px-1 border-b-2 border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-500 font-medium text-sm" data-tab="documents">Documents</button>
                        <button class="tab-button whitespace-nowrap py-2.5 px-1 border-b-2 border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-500 font-medium text-sm" data-tab="compliance">Compliance & Suitability</button>
                    </nav>
                </div>

                <!-- Tab Content -->
                <div id="overview-tab-content" class="tab-content active-tab-content">
                    <h4 class="text-xl font-semibold text-gray-800 dark:text-gray-100 mb-4">Client Overview</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                        <div>
                            <p class="text-gray-600 dark:text-gray-400 mb-1.5 text-sm"><strong class="text-gray-800 dark:text-gray-300">Email:</strong> <span id="client-email-display"></span></p>
                            <p class="text-gray-600 dark:text-gray-400 mb-1.5 text-sm"><strong class="text-gray-800 dark:text-gray-300">Phone:</strong> <span id="client-phone-display"></span></p>
                            <p class="text-gray-600 dark:text-gray-400 mb-1.5 text-sm"><strong class="text-gray-800 dark:text-gray-300">Risk Tolerance:</strong> <span id="client-risk-display"></span></p>
                            <p class="text-gray-600 dark:text-gray-400 mb-1.5 text-sm"><strong class="text-gray-800 dark:text-gray-300">Financial Goals:</strong> <span id="client-goals-display"></span></p>
                        </div>
                        <div>
                            <h5 class="font-semibold text-gray-800 dark:text-gray-300 mb-2">Net Worth Summary</h5>
                            <p class="text-gray-600 dark:text-gray-400 mb-1 text-sm">Assets: $<span id="client-assets-display"></span></p>
                            <p class="text-gray-600 dark:text-gray-400 mb-1 text-sm">Liabilities: $<span id="client-liabilities-display"></span></p>
                            <p class="text-gray-800 dark:text-gray-200 font-bold mt-2 text-base">Net Worth: $<span id="client-networth-display"></span></p>
                        </div>
                    </div>
                </div>

                <div id="portfolio-tab-content" class="tab-content hidden">
                    <h4 class="text-xl font-semibold text-gray-800 dark:text-gray-100 mb-4">Portfolio Management</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-5 mb-6">
                        <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
                            <h5 class="font-semibold text-gray-800 dark:text-gray-300 mb-2">Portfolio Performance (YTD)</h5>
                            <div class="h-72">
                                <canvas id="clientPortfolioPerformanceChart"></canvas>
                            </div>
                        </div>
                        <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
                            <h5 class="font-semibold text-gray-800 dark:text-gray-300 mb-2">Cash Flow Trends</h5>
                            <div class="h-72">
                                <canvas id="clientCashFlowChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <h5 class="font-semibold text-gray-800 dark:text-gray-300 mt-2 mb-3">Current Holdings</h5>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-600 text-sm">
                            <thead class="bg-gray-50 dark:bg-gray-800">
                                <tr>
                                    <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-400">Asset</th>
                                    <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-400">Type</th>
                                    <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-400">Value (USD)</th>
                                    <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-400">P&L</th>
                                    <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-400">Currency</th>
                                    <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-400">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white dark:bg-gray-700 divide-y divide-gray-200 dark:divide-gray-600">
                                <tr>
                                    <td class="px-4 py-3 whitespace-nowrap text-gray-700 dark:text-gray-300">Apple Inc.</td>
                                    <td class="px-4 py-3 whitespace-nowrap text-gray-700 dark:text-gray-300">Equity</td>
                                    <td class="px-4 py-3 whitespace-nowrap text-gray-700 dark:text-gray-300">$1,500,000</td>
                                    <td class="px-4 py-3 whitespace-nowrap text-green-600">+5.2%</td>
                                    <td class="px-4 py-3 whitespace-nowrap text-gray-700 dark:text-gray-300">USD</td>
                                    <td class="px-4 py-3 whitespace-nowrap">
                                        <button class="bg-red-500 text-white px-3 py-1 rounded-md text-xs hover:bg-red-600 transition-colors duration-200">Sell</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="px-4 py-3 whitespace-nowrap text-gray-700 dark:text-gray-300">Saudi Aramco</td>
                                    <td class="px-4 py-3 whitespace-nowrap text-gray-700 dark:text-gray-300">Equity</td>
                                    <td class="px-4 py-3 whitespace-nowrap text-green-600">$800,000</td>
                                    <td class="px-4 py-3 whitespace-nowrap text-green-600">+3.1%</td>
                                    <td class="px-4 py-3 whitespace-nowrap text-gray-700 dark:text-gray-300">SAR</td>
                                    <td class="px-4 py-3 whitespace-nowrap">
                                        <button class="bg-red-500 text-white px-3 py-1 rounded-md text-xs hover:bg-red-600 transition-colors duration-200">Sell</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="px-4 py-3 whitespace-nowrap text-gray-700 dark:text-gray-300">UAE Government Sukuk</td>
                                    <td class="px-4 py-3 whitespace-nowrap text-gray-700 dark:text-gray-300">Fixed Income (Sukuk)</td>
                                    <td class="px-4 py-3 whitespace-nowrap text-gray-700 dark:text-gray-300">$2,000,000</td>
                                    <td class="px-4 py-3 whitespace-nowrap text-gray-600 dark:text-gray-400">--</td>
                                    <td class="px-4 py-3 whitespace-nowrap text-gray-700 dark:text-gray-300">AED</td>
                                    <td class="px-4 py-3 whitespace-nowrap">
                                        <button class="bg-red-500 text-white px-3 py-1 rounded-md text-xs hover:bg-red-600 transition-colors duration-200">Sell</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div id="interactions-tab-content" class="tab-content hidden">
                    <h4 class="text-xl font-semibold text-gray-800 dark:text-gray-100 mb-4">Client Interaction History</h4>
                    <ul class="space-y-3">
                        <li class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg text-gray-900 dark:text-gray-200 text-sm">
                            <div class="flex items-center justify-between mb-2">
                                <span class="font-medium text-gray-800 dark:text-gray-200">Meeting: Portfolio Review</span>
                                <span class="text-xs text-gray-500 dark:text-gray-400">2024-06-20</span>
                            </div>
                            <p class="text-gray-600 dark:text-gray-400 text-xs">Discussed Q2 performance, agreed to increase exposure to alternatives. Generated performance report.</p>
                        </li>
                        <li class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg text-gray-900 dark:text-gray-200 text-sm">
                            <div class="flex items-center justify-between mb-2">
                                <span class="font-medium text-gray-800 dark:text-gray-200">Email: Market Update</span>
                                <span class="text-xs text-gray-500 dark:text-gray-400">2024-06-15</span>
                            </div>
                            <p class="text-gray-600 dark:text-gray-400 text-xs">Sent personalized market update focusing on energy sector trends in GCC.</p>
                        </li>
                    </ul>
                </div>

                <div id="goals-tab-content" class="tab-content hidden">
                    <h4 class="text-xl font-semibold text-gray-800 dark:text-gray-100 mb-4">Financial Goals & Advisory</h4>
                    <div class="space-y-4">
                        <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg text-gray-900 dark:text-gray-200 text-sm">
                            <div class="flex items-center justify-between mb-2">
                                <h5 class="font-semibold text-gray-800 dark:text-gray-200">Retirement Planning</h5>
                                <span class="text-xs text-gray-500 dark:text-gray-400">Target: 2040</span>
                            </div>
                            <p class="text-gray-600 dark:text-gray-400 text-xs mb-2">Current Progress: 65% ($1.3M / $2M)</p>
                            <div class="w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2.5">
                                <div class="bg-green-600 h-2.5 rounded-full" style="width: 65%"></div>
                            </div>
                        </div>
                        <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg text-gray-900 dark:text-gray-200 text-sm">
                            <div class="flex items-center justify-between mb-2">
                                <h5 class="font-semibold text-gray-800 dark:text-gray-200">Child's Education Fund</h5>
                                <span class="text-xs text-gray-500 dark:text-gray-400">Target: 2030</span>
                            </div>
                            <p class="text-gray-600 dark:text-gray-400 text-xs mb-2">Current Progress: 40% ($200K / $500K)</p>
                            <div class="w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2.5">
                                <div class="bg-yellow-500 h-2.5 rounded-full" style="width: 40%"></div>
                            </div>
                        </div>
                    </div>
                    <button class="mt-6 bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors duration-200 shadow-md text-sm">
                        <i class="fas fa-plus mr-2"></i>Add New Goal
                    </button>
                </div>

                <div id="documents-tab-content" class="tab-content hidden">
                    <h4 class="text-xl font-semibold text-gray-800 dark:text-gray-100 mb-4">Document Vault</h4>
                    <ul class="space-y-3">
                        <li class="bg-gray-50 dark:bg-gray-800 p-3 rounded-lg flex items-center justify-between text-gray-900 dark:text-gray-200 text-sm">
                            <span><i class="fas fa-file-pdf mr-2 text-red-500"></i>KYC Document - Passport.pdf</span>
                            <span class="text-xs text-gray-500 dark:text-gray-400">Uploaded: 2023-11-01</span>
                            <a href="#" class="text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-500 text-xs ml-auto">View</a>
                        </li>
                        <li class="bg-gray-50 dark:bg-gray-800 p-3 rounded-lg flex items-center justify-between text-gray-900 dark:text-gray-200 text-sm">
                            <span><i class="fas fa-file-excel mr-2 text-green-600"></i>Q1 2024 Portfolio Statement.xlsx</span>
                            <span class="text-xs text-gray-500 dark:text-gray-400">Generated: 2024-04-10</span>
                            <a href="#" class="text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-500 text-xs ml-auto">Download</a>
                        </li>
                    </ul>
                    <button class="mt-6 bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors duration-200 shadow-md text-sm">
                        <i class="fas fa-upload mr-2"></i>Upload Document
                    </button>
                </div>

                <div id="compliance-tab-content" class="tab-content hidden">
                    <h4 class="text-xl font-semibold text-gray-800 dark:text-gray-100 mb-4">Compliance & Suitability Checks</h4>
                    <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg mb-4 text-sm">
                        <p class="text-gray-600 dark:text-gray-400">
                            <strong class="text-gray-800 dark:text-gray-200">Suitability Score:</strong> <span class="font-semibold text-green-600">92/100</span> (Well-aligned with risk profile)
                        </p>
                        <p class="text-gray-600 dark:text-gray-400 mt-2 text-xs">
                            <strong class="text-gray-800 dark:text-gray-200">Regulatory Status:</strong> All KYC up-to-date. DFSA & FSRA guidelines adhered to.
                        </p>
                    </div>
                    <h5 class="font-semibold text-gray-800 dark:text-gray-300 mb-2">Audit Trail</h5>
                    <ul class="space-y-3">
                        <li class="bg-gray-50 dark:bg-gray-800 p-3 rounded-lg text-gray-900 dark:text-gray-200 text-sm">
                            <p class="text-gray-600 dark:text-gray-400 text-xs"><strong class="text-gray-800 dark:text-gray-200">2024-06-20 14:35:</strong> Portfolio rebalanced based on client's updated risk tolerance. (WM: Jane Doe)</p>
                        </li>
                        <li class="bg-gray-50 dark:bg-gray-800 p-3 rounded-lg text-gray-900 dark:text-gray-200 text-sm">
                            <p class="text-gray-600 dark:text-gray-400 text-xs"><strong class="text-gray-800 dark:text-gray-200">2024-05-01 09:10:</strong> KYC documents reviewed and verified. (RM: John Smith)</p>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- New: Client Account Dashboard View -->
        <div id="account-dashboard-view" class="content-view hidden">
            <button class="text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-500 mb-4 flex items-center text-sm" onclick="showClient360FromAccount()">
                <i class="fas fa-arrow-left mr-2"></i>Back to Client Overview
            </button>
            <div id="account-dashboard-header" class="bg-white dark:bg-gray-700 p-5 rounded-lg shadow-md border border-gray-200 dark:border-gray-600 mb-6 flex items-center space-x-5 transition-colors duration-300">
                <div class="w-20 h-20 bg-gray-200 dark:bg-gray-800 rounded-full flex items-center justify-center text-gray-500 dark:text-gray-400 text-3xl">
                    <i class="fas fa-university"></i>
                </div>
                <div>
                    <h3 id="account-name-display" class="text-2xl font-bold text-gray-800 dark:text-gray-100 mb-0.5">Account Name</h3>
                    <p id="account-aum-display" class="text-lg text-gray-700 dark:text-gray-300">AUM: $0</p>
                    <p id="account-type-display" class="text-xs text-gray-500 dark:text-gray-400">Type: Discretionary</p>
                </div>
                <div class="ml-auto flex space-x-3">
                    <button class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors duration-200 shadow-md text-sm">
                        <i class="fas fa-chart-pie mr-2"></i>View Portfolio
                    </button>
                    <button class="bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-200 px-4 py-2 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-700 transition-colors duration-200 shadow-md text-sm">
                        <i class="fas fa-file-download mr-2"></i>Download Statement
                    </button>
                </div>
            </div>

            <div class="bg-white dark:bg-gray-700 p-5 rounded-lg shadow-md border border-gray-200 dark:border-gray-600 transition-colors duration-300">
                <!-- Account Dashboard Tabs -->
                <div class="border-b border-gray-200 dark:border-gray-600 mb-5">
                    <nav class="-mb-px flex space-x-6" aria-label="Account Tabs">
                        <button class="account-tab-button whitespace-nowrap py-2.5 px-1 border-b-2 font-medium text-sm border-blue-500 text-blue-600 dark:border-blue-400 dark:text-blue-400 active-tab" data-tab="portfolio-overview">Portfolio Overview</button>
                        <button class="account-tab-button whitespace-nowrap py-2.5 px-1 border-b-2 border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-500 font-medium text-sm" data-tab="account-summary">Account Summary</button>
                        <button class="account-tab-button whitespace-nowrap py-2.5 px-1 border-b-2 border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-500 font-medium text-sm" data-tab="risk-alerts">Risk & Alerts</button>
                        <button class="account-tab-button whitespace-nowrap py-2.5 px-1 border-b-2 border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-500 font-medium text-sm" data-tab="cash-liquidity">Cash & Liquidity</button>
                        <button class="account-tab-button whitespace-nowrap py-2.5 px-1 border-b-2 border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-500 font-medium text-sm" data-tab="recent-transactions">Recent Transactions</button>
                        <button class="account-tab-button whitespace-nowrap py-2.5 px-1 border-b-2 border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-500 font-medium text-sm" data-tab="account-documents">Documents Tab</button>
                    </nav>
                </div>

                <!-- Account Tab Content -->
                <div id="portfolio-overview-tab-content" class="account-tab-content active-tab-content">
                    <h4 class="text-xl font-semibold text-gray-800 dark:text-gray-100 mb-4">Portfolio Overview</h4>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-5 mb-6">
                        <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
                            <h5 class="font-semibold text-gray-800 dark:text-gray-300 mb-2">Portfolio Breakdown by Asset Class</h5>
                            <div class="h-72">
                                <canvas id="accountPortfolioBreakdownChart"></canvas>
                            </div>
                        </div>
                        <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
                            <h5 class="font-semibold text-gray-800 dark:text-gray-300 mb-2">Change in Portfolio Value</h5>
                            <div class="flex justify-center gap-2 mb-3">
                                <button class="portfolio-duration-button px-3 py-1 text-xs rounded-full bg-blue-500 text-white dark:bg-blue-600" data-duration="1M">1M</button>
                                <button class="portfolio-duration-button px-3 py-1 text-xs rounded-full bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300" data-duration="3M">3M</button>
                                <button class="portfolio-duration-button px-3 py-1 text-xs rounded-full bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300" data-duration="YTD">YTD</button>
                                <button class="portfolio-duration-button px-3 py-1 text-xs rounded-full bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300" data-duration="1Y">1Y</button>
                                <button class="portfolio-duration-button px-3 py-1 text-xs rounded-full bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300" data-duration="3Y">3Y</button>
                            </div>
                            <div class="h-72">
                                <canvas id="accountPortfolioValueChangeChart"></canvas>
                            </div>
                        </div>
                        <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
                            <h5 class="font-semibold text-gray-800 dark:text-gray-300 mb-2">Current Allocation vs Strategic Allocation</h5>
                            <div class="h-72">
                                <canvas id="accountAllocationComparisonChart"></canvas>
                            </div>
                        </div>
                        <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
                            <h5 class="font-semibold text-gray-800 dark:text-gray-300 mb-2">Allocation Movement over time</h5>
                            <div class="h-72">
                                <canvas id="accountAllocationMovementChart"></canvas>
                            </div>
                        </div>
                        <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg col-span-1 lg:col-span-2">
                            <h5 class="font-semibold text-gray-800 dark:text-gray-300 mb-2">Sector Allocation</h5>
                            <div class="h-72">
                                <canvas id="accountSectorAllocationChart"></canvas>
                            </div>
                        </div>
                    </div>
                    <h5 class="font-semibold text-gray-800 dark:text-gray-300 mt-2 mb-3">Top 5 Holdings</h5>
                    <div class="overflow-x-auto mb-6">
                        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-600 text-sm">
                            <thead class="bg-gray-50 dark:bg-gray-800">
                                <tr>
                                    <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-400">Holding</th>
                                    <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-400">Weight (%)</th>
                                    <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-400">Return (%)</th>
                                    <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-400">Currency</th>
                                </tr>
                            </thead>
                            <tbody id="top-holdings-table-body" class="bg-white dark:bg-gray-700 divide-y divide-gray-200 dark:divide-gray-600">
                                <!-- Top holdings will be populated here -->
                            </tbody>
                        </table>
                    </div>
                    <h5 class="font-semibold text-gray-800 dark:text-gray-300 mt-2 mb-3">Bottom 5 Holdings</h5>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-600 text-sm">
                            <thead class="bg-gray-50 dark:bg-gray-800">
                                <tr>
                                    <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-400">Holding</th>
                                    <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-400">Weight (%)</th>
                                    <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-400">Return (%)</th>
                                    <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-400">Currency</th>
                                </tr>
                            </thead>
                            <tbody id="bottom-holdings-table-body" class="bg-white dark:bg-gray-700 divide-y divide-gray-200 dark:divide-gray-600">
                                <!-- Bottom holdings will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <div id="account-summary-tab-content" class="account-tab-content hidden">
                    <h4 class="text-xl font-semibold text-gray-800 dark:text-gray-100 mb-4">Account Summary</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                        <div>
                            <p class="text-gray-600 dark:text-gray-400 mb-1.5"><strong class="text-gray-800 dark:text-gray-300">Account Creation Date:</strong> <span id="summary-creation-date"></span></p>
                            <p class="text-gray-600 dark:text-gray-400 mb-1.5"><strong class="text-gray-800 dark:text-gray-300">Mandate Type:</strong> <span id="summary-mandate-type"></span></p>
                            <p class="text-gray-600 dark:text-gray-400 mb-1.5"><strong class="text-gray-800 dark:text-gray-300">Custodian Name:</strong> <span id="summary-custodian"></span></p>
                            <p class="text-gray-600 dark:text-gray-400 mb-1.5"><strong class="text-gray-800 dark:text-gray-300">Currency Used:</strong> <span id="summary-currency"></span></p>
                        </div>
                        <div>
                            <p class="text-gray-600 dark:text-gray-400 mb-1.5"><strong class="text-gray-800 dark:text-gray-300">Compliance Status:</strong> <span id="summary-compliance-status" class="font-semibold"></span></p>
                            <p class="text-gray-600 dark:text-gray-400 mb-1.5"><strong class="text-gray-800 dark:text-gray-300">Investment Guidelines:</strong> <span id="summary-investment-guidelines"></span></p>
                        </div>
                    </div>
                </div>

                <div id="risk-alerts-tab-content" class="account-tab-content hidden">
                    <h4 class="text-xl font-semibold text-gray-800 dark:text-gray-100 mb-4">Risk & Alerts</h4>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-5 mb-6">
                        <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg text-center">
                            <h5 class="font-semibold text-gray-800 dark:text-gray-300 mb-2">Current Risk Score</h5>
                            <div class="gauge-chart-container">
                                <div class="gauge-chart-arc" id="risk-gauge-arc"></div>
                                <div class="gauge-chart-value-arc" id="risk-gauge-value-arc"></div>
                                <div class="gauge-chart-needle" id="risk-gauge-needle"></div>
                                <div class="gauge-chart-center-dot"></div>
                                <div class="gauge-chart-label" id="risk-gauge-label"></div>
                            </div>
                        </div>
                        <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
                            <h5 class="font-semibold text-gray-800 dark:text-gray-300 mb-2">Historical Risk Score Trend</h5>
                            <div class="h-72">
                                <canvas id="accountHistoricalRiskChart"></canvas>
                            </div>
                        </div>
                    </div>
                    <h5 class="font-semibold text-gray-800 dark:text-gray-300 mb-3">Active Flags & Alerts</h5>
                    <ul id="risk-alerts-list" class="space-y-2 text-sm">
                        <!-- Alerts will be populated here -->
                    </ul>
                </div>

                <div id="cash-liquidity-tab-content" class="account-tab-content hidden">
                    <h4 class="text-xl font-semibold text-gray-800 dark:text-gray-100 mb-4">Cash & Liquidity</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                        <div>
                            <p class="text-gray-600 dark:text-gray-400 mb-1.5"><strong class="text-gray-800 dark:text-gray-300">Available Cash:</strong> <span id="cash-available" class="font-bold"></span></p>
                            <p class="text-gray-600 dark:text-gray-400 mb-1.5"><strong class="text-gray-800 dark:text-gray-300">Pending Inflows:</strong> <span id="cash-inflows"></span></p>
                            <p class="text-gray-600 dark:text-gray-400 mb-1.5"><strong class="text-gray-800 dark:text-gray-300">Pending Outflows:</strong> <span id="cash-outflows"></span></p>
                        </div>
                        <div>
                            <p class="text-gray-600 dark:text-gray-400 mb-1.5"><strong class="text-gray-800 dark:text-gray-300">Recommended Cash Buffer:</strong> <span id="cash-recommended"></span></p>
                            <p class="text-gray-600 dark:text-gray-400 mb-1.5"><strong class="text-gray-800 dark:text-gray-300">Upcoming Redemptions/Maturities:</strong> <span id="cash-redemptions"></span></p>
                        </div>
                    </div>
                </div>

                <div id="recent-transactions-tab-content" class="account-tab-content hidden">
                    <h4 class="text-xl font-semibold text-gray-800 dark:text-gray-100 mb-4">Recent Transactions</h4>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-600 text-sm">
                            <thead class="bg-gray-50 dark:bg-gray-800">
                                <tr>
                                    <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-400">Date</th>
                                    <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-400">Security</th>
                                    <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-400">Type</th>
                                    <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-400">Quantity</th>
                                    <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-400">Value</th>
                                    <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-400">Currency</th>
                                    <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-400">Status</th>
                                </tr>
                            </thead>
                            <tbody id="transactions-table-body" class="bg-white dark:bg-gray-700 divide-y divide-gray-200 dark:divide-gray-600">
                                <!-- Transactions will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <div id="account-documents-tab-content" class="account-tab-content hidden">
                    <h4 class="text-xl font-semibold text-gray-800 dark:text-gray-100 mb-4">Account Document Vault</h4>
                    <ul id="account-documents-list" class="space-y-3">
                        <!-- Account documents will be populated here -->
                    </ul>
                    <button class="mt-6 bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors duration-200 shadow-md text-sm">
                        <i class="fas fa-upload mr-2"></i>Upload Document
                    </button>
                </div>
            </div>
        </div>

        <!-- Products View -->
        
<div id="products-view" class="content-view hidden">

    <!-- Product Insights Toggle Buttons -->
    <div class="flex justify-center gap-4 mb-6">
        <button id="products-performance-toggle" class="px-5 py-2 rounded-full text-sm font-medium bg-blue-500 text-white dark:bg-blue-600 transition-colors duration-200">Performance</button>
        <button id="products-risk-toggle" class="px-5 py-2 rounded-full text-sm font-medium bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors duration-200">Risk</button>
        <button id="products-flows-toggle" class="px-5 py-2 rounded-full text-sm font-medium bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors duration-200">Flows</button>
    </div>

    <!-- Dynamic Content Area for Products Insights -->
    <div id="products-insights-content" class="bg-white dark:bg-gray-700 p-5 rounded-lg shadow-md border border-gray-200 dark:border-gray-600 mb-6">
        <!-- Performance Heatmap (Default) -->
        <div id="performance-heatmap-content">
            <h4 class="text-xl font-semibold text-gray-800 dark:text-gray-100 mb-4">Product Performance Heatmap (1-Year Return %)</h4>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-600 text-center">
                    <thead>
                        <tr>
                            <th class="px-3 py-2 text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider text-left">Category / Month</th>
                            <th class="px-3 py-2 text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Month 1</th>
                            <th class="px-3 py-2 text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Month 2</th>
                            <th class="px-3 py-2 whitespace-nowrap text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Month 3</th>
                            <th class="px-3 py-2 whitespace-nowrap text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Month 4</th>
                            <th class="px-3 py-2 whitespace-nowrap text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Month 5</th>
                            <th class="px-3 py-2 whitespace-nowrap text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Month 6</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white dark:bg-gray-700 divide-y divide-gray-200 dark:divide-gray-600">
                        <!-- Example Row -->
                        <tr class="dark:text-gray-300">
                            <td class="px-3 py-2 whitespace-nowrap font-medium text-left">Equities</td>
                            <td class="px-3 py-2 whitespace-nowrap" style="background-color: hsl(0, 100%, 70%);"> -2.1% </td>
                            <td class="px-3 py-2 whitespace-nowrap" style="background-color: hsl(120, 100%, 70%);"> +1.5% </td>
                            <td class="px-3 py-2 whitespace-nowrap" style="background-color: hsl(120, 100%, 50%);"> +3.2% </td>
                            <td class="px-3 py-2 whitespace-nowrap" style="background-color: hsl(120, 100%, 70%);"> +1.8% </td>
                            <td class="px-3 py-2 whitespace-nowrap" style="background-color: hsl(0, 100%, 75%);"> -0.5% </td>
                            <td class="px-3 py-2 whitespace-nowrap" style="background-color: hsl(120, 100%, 60%);"> +2.0% </td>
                        </tr>
                        <tr class="dark:text-gray-300">
                            <td class="px-3 py-2 whitespace-nowrap font-medium text-left">Sukuk</td>
                            <td class="px-3 py-2 whitespace-nowrap" style="background-color: hsl(120, 100%, 65%);"> +0.8% </td>
                            <td class="px-3 py-2 whitespace-nowrap" style="background-color: hsl(120, 100%, 70%);"> +0.5% </td>
                            <td class="px-3 py-2 whitespace-nowrap" style="background-color: hsl(120, 100%, 60%);"> +1.2% </td>
                            <td class="px-3 py-2 whitespace-nowrap" style="background-color: hsl(120, 100%, 65%);"> +0.7% </td>
                            <td class="px-3 py-2 whitespace-nowrap" style="background-color: hsl(120, 100%, 55%);"> +1.0% </td>
                            <td class="px-3 py-2 whitespace-nowrap" style="background-color: hsl(120, 100%, 60%);"> +0.9% </td>
                        </tr>
                        <tr class="dark:text-gray-300">
                            <td class="px-3 py-2 whitespace-nowrap font-medium text-left">Mutual Funds & ETFs</td>
                            <td class="px-3 py-2 whitespace-nowrap" style="background-color: hsl(0, 100%, 70%);"> -1.0% </td>
                            <td class="px-3 py-2 whitespace-nowrap" style="background-color: hsl(120, 100%, 70%);"> +0.8% </td>
                            <td class="px-3 py-2 whitespace-nowrap" style="background-color: hsl(120, 100%, 60%);"> +1.5% </td>
                            <td class="px-3 py-2 whitespace-nowrap" style="background-color: hsl(0, 100%, 65%);"> -0.2% </td>
                            <td class="px-3 py-2 whitespace-nowrap" style="background-color: hsl(120, 100%, 50%);"> +2.0% </td>
                            <td class="px-3 py-2 whitespace-nowrap" style="background-color: hsl(120, 100%, 70%);"> +1.0% </td>
                        </tr>
                        <!-- Add more categories for heatmap -->
                    </tbody>
                </table>
            </div>
        </div>
        <!-- Risk Content (hidden by default) -->
        <div id="risk-content" class="hidden">
            <h4 class="text-xl font-semibold text-gray-800 dark:text-gray-100 mb-4">Product Risk Profiles</h4>
            <p class="text-gray-700 dark:text-gray-300">Details about product risk profiling and volatility metrics will appear here.</p>
            <ul class="list-disc list-inside text-gray-600 dark:text-gray-400 mt-2 text-sm">
                <li>Sharpe Ratios by category</li>
                <li>Maximum Drawdowns</li>
                <li>Value at Risk (VaR)</li>
            </ul>
        </div>
        <!-- Flows Content (hidden by default) -->
        <div id="flows-content" class="hidden">
            <h4 class="text-xl font-semibold text-gray-800 dark:text-gray-100 mb-4">Detailed Product Flows</h4>
            <p class="text-gray-700 dark:text-gray-300">Detailed historical and projected cash flow movements for each product category will be displayed here.</p>
            <ul class="list-disc list-inside text-gray-600 dark:text-gray-400 mt-2 text-sm">
                <li>Monthly Inflow/Outflow Trends</li>
                <li>Net Flow Comparisons</li>
                <li>Flow Attribution Analysis</li>
            </ul>
        </div>
    </div>


    <!-- Product Filters and Sort -->
    <div class="flex flex-wrap items-center gap-3 mb-6">
        <span class="text-gray-700 dark:text-gray-300 text-sm font-medium">Filter by:</span>
        <div class="flex rounded-full bg-gray-200 dark:bg-gray-800 p-0.5">
            <button class="filter-button px-3 py-1 text-sm font-medium rounded-full active bg-blue-500 text-white dark:bg-blue-600 dark:text-gray-100" data-category="All">All</button>
            <button class="filter-button px-3 py-1 text-sm font-medium rounded-full text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-500" data-category="Equities">Equities</button>
            <button class="filter-button px-3 py-1 text-sm font-medium rounded-full text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-500" data-category="Sukuk">Sukuk</button>
            <button class="filter-button px-3 py-1 text-sm font-medium rounded-full text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-500" data-category="Mutual Funds & ETFs">Mutual Funds & ETFs</button>
            <button class="filter-button px-3 py-1 text-sm font-medium rounded-full text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-500" data-category="Real Estate/REITs">Real Estate/REITs</button>
            <button class="filter-button px-3 py-1 text-sm font-medium rounded-full text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-500" data-category="Commodities">Commodities</button>
            <button class="filter-button px-3 py-1 text-sm font-medium rounded-full text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-500" data-category="Private Equity/VC">Private Equity/VC</button>
        </div>

        <!-- Shariah Compliance Toggle (for Mutual Funds & ETFs) -->
        <div class="flex items-center gap-2 ml-4 toggle-shariah hidden">
            <label for="shariah-toggle" class="relative inline-flex items-center cursor-pointer">
                <input type="checkbox" id="shariah-toggle" class="sr-only peer" checked>
                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border after:border-gray-300 after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div>
                <span class="ml-2 text-sm font-medium text-gray-700 dark:text-gray-300">Shari'ah Compliant</span>
            </label>
        </div>

        <!-- Sort by Dropdown -->
        <div class="ml-auto flex items-center gap-2">
            <label for="sort-by" class="text-sm font-medium text-gray-700 dark:text-gray-300">Sort by:</label>
            <select id="sort-by" class="px-3 py-1 rounded-md border border-gray-300 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                <option value="none">Default</option>
                <option value="return-asc">1-Year Return (Low to High)</option>
                <option value="return-desc">1-Year Return (High to Low)</option>
            </select>
        </div>

        <!-- Filter by Currency Dropdown -->
        <div class="flex items-center gap-2">
            <label for="filter-currency" class="text-sm font-medium text-gray-700 dark:text-gray-300">Currency:</label>
            <select id="filter-currency" class="px-3 py-1 rounded-md border border-gray-300 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                <option value="All">All</option>
                <option value="USD">USD</option>
                <option value="AED">AED</option>
                <option value="SAR">SAR</option>
                <option value="EUR">EUR</option>
                <option value="KWD">KWD</option>
            </select>
        </div>
    </div>

    <!-- Product Cards Grid -->
    <div id="product-cards-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        <!-- Product Card Template -->
        <!-- Populated dynamically by JavaScript -->
    </div>
</div>

<!-- Reports View (Placeholder) -->
        <div id="reports-view" class="content-view hidden">
            <h3 class="text-2xl font-semibold text-gray-800 dark:text-gray-100 mb-6">Reports & Analytics</h3>
            <div class="bg-white dark:bg-gray-700 p-6 rounded-lg shadow-md border border-gray-200 dark:border-gray-600 transition-colors duration-300">
                <p class="text-gray-700 dark:text-gray-300 text-sm mb-5">Generate custom client reports, performance statements, and compliance summaries.</p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                    <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
                        <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-2">Client Reports</h4>
                        <ul class="list-disc pl-5 text-gray-600 dark:text-gray-400 text-sm">
                            <li>Quarterly Performance</li>
                            <li>Annual Review</li>
                            <li>Goal Progress Report</li>
                        </ul>
                        <button class="mt-4 bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 text-sm shadow-md">Create New Report</button>
                    </div>
                    <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
                        <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-2">Compliance & Audit</h4>
                        <p class="text-gray-600 dark:text-gray-400 text-sm mb-3">Generate regulatory reports and audit trails for compliance purposes.</p>
                        <button class="mt-4 bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 text-sm shadow-md">Access Audit Logs</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Compliance View (Placeholder) -->
        <div id="compliance-view" class="content-view hidden">
            <h3 class="text-2xl font-semibold text-gray-800 dark:text-gray-100 mb-6">Compliance & Regulatory Overview</h3>
            <div class="bg-white dark:bg-gray-700 p-6 rounded-lg shadow-md border border-gray-200 dark:border-gray-600 transition-colors duration-300">
                <p class="text-gray-700 dark:text-gray-300 text-sm mb-5">Ensure adherence to regional regulations like DFSA and FSRA with automated checks and audit capabilities.</p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                    <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
                        <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-2">Compliance Status</h4>
                        <ul class="list-disc pl-5 text-gray-600 dark:text-gray-400 text-sm">
                            <li>KYC Completion Rate: <span class="font-bold text-green-600">98%</span></li>
                            <li>Pending Suitability Reviews: <span class="font-bold text-yellow-600">5</span></li>
                            <li>Regulatory Updates: <span class="text-blue-600 dark:text-blue-400 hover:underline cursor-pointer">View Latest</span></li>
                        </ul>
                    </div>
                    <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
                        <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-2">Audit Trail Access</h4>
                        <p class="text-gray-600 dark:text-gray-400 text-sm mb-3">Full immutable audit logs of all platform activities and client interactions.</p>
                        <button class="mt-4 bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 text-sm shadow-md">Access Audit Logs</button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Dummy Client Data
        const clients = {
            client1: {
                id: "client1",
                name: "Mr. Ahmed Al-Farsi",
                aum: "150,000,000",
                rm: "Jane Doe",
                email: "ahmed.alfarsi@example.com",
                phone: "+971 50 123 4567",
                risk: "Aggressive",
                goals: "Wealth Growth, Real Estate Investment",
                assets: "160,000,000",
                liabilities: "10,000,000",
                netWorth: "150,000,000",
                accounts: [
                    {
                        accountId: "acc101",
                        accountType: "Discretionary Account",
                        riskScore: 85, // out of 100
                        aum: "75,000,000",
                        lastActivity: "2024-06-28",
                        portfolioBreakdown: {
                            labels: ['Equities', 'Fixed Income', 'Commodities', 'Cash'],
                            data: [50, 25, 15, 10]
                        },
                        portfolioValueChange: {
                            '1M': [5000000, 5050000, 5100000, 5120000],
                            '3M': [4800000, 4900000, 5000000, 5050000, 5100000, 5120000, 5150000, 5180000, 5200000, 5250000, 5280000, 5300000],
                            'YTD': [4500000, 4600000, 4700000, 4800000, 4900000, 5000000, 5050000, 5100000, 5120000, 5150000, 5180000, 5200000],
                            '1Y': [4000000, 4200000, 4400000, 4600000, 4800000, 5000000, 5050000, 5100000, 5120000, 5150000, 5180000, 5200000],
                            '3Y': [3000000, 3500000, 4000000, 4500000, 5000000, 5050000, 5100000, 5120000, 5150000, 5180000, 5200000, 5250000]
                        },
                        currentAllocation: [45, 30, 15, 10],
                        strategicAllocation: [40, 35, 15, 10],
                        allocationMovement: {
                            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                            equity: [40, 42, 43, 45, 46, 48],
                            fixedIncome: [35, 33, 32, 30, 29, 27]
                        },
                        sectorAllocation: {
                            labels: ['Financials', 'Energy', 'Technology', 'Healthcare', 'Industrials', 'Utilities'],
                            data: [25, 20, 15, 12, 10, 8]
                        },
                        topHoldings: [
                            { name: "Saudi Aramco", weight: 8.5, return: 3.1, currency: "SAR" },
                            { name: "Apple Inc.", weight: 7.2, return: 5.2, currency: "USD" },
                            { name: "UAE Government Sukuk", weight: 6.0, return: 0.8, currency: "AED" },
                            { name: "Microsoft Corp.", weight: 5.8, return: 4.5, currency: "USD" },
                            { name: "ADNOC Distribution", weight: 5.0, return: 2.9, currency: "AED" }
                        ],
                        bottomHoldings: [
                            { name: "Small Cap Tech Fund", weight: 1.2, return: -2.5, currency: "USD" },
                            { name: "Emerging Market Bond", weight: 1.5, return: -1.0, currency: "USD" },
                            { name: "Local Real Estate Trust", weight: 1.8, return: 0.1, currency: "AED" },
                            { name: "Gold ETF", weight: 2.0, return: -0.5, currency: "USD" },
                            { name: "Biotech Startup", weight: 0.5, return: -5.0, currency: "USD" }
                        ],
                        summary: {
                            creationDate: "2020-01-15",
                            mandateType: "Discretionary",
                            custodianName: "ABC Custodian Bank",
                            complianceStatus: "Compliant (No Flags)",
                            investmentGuidelines: "Focus on Shari'ah-compliant assets, max 10% in illiquid assets.",
                            currencyUsed: "USD, AED, SAR"
                        },
                        historicalRiskScore: [80, 82, 85, 83, 86, 85],
                        alerts: [
                            { type: "Over-concentration", description: "Equity exposure exceeds 50% limit by 5%", severity: "High" },
                            { type: "Limit Breaches", description: "Single stock exposure (Saudi Aramco) at 8.5%, nearing 10% limit.", severity: "Medium" }
                        ],
                        cashLiquidity: {
                            availableCash: "5,000,000",
                            pendingInflows: "1,200,000 (Dividends, Bond Maturity)",
                            pendingOutflows: "300,000 (Management Fees, Planned Investment)",
                            recommendedCashBuffer: "2,000,000",
                            upcomingRedemptions: "UAE Sukuk (AED 500,000) - 2024-07-30"
                        },
                        transactions: [
                            { date: "2024-06-25", security: "Apple Inc.", type: "Buy", quantity: 100, value: "18,000", currency: "USD", status: "Completed" },
                            { date: "2024-06-20", security: "Saudi Aramco", type: "Sell", quantity: 500, value: "19,000", currency: "SAR", status: "Completed" },
                            { date: "2024-06-18", security: "UAE Government Sukuk", type: "Buy", quantity: 2, value: "200,000", currency: "AED", status: "Completed" },
                            { date: "2024-06-10", security: "Microsoft Corp.", type: "Buy", quantity: 50, value: "10,000", currency: "USD", status: "Pending" }
                        ],
                        documents: [
                            { name: "Account Opening Form.pdf", date: "2020-01-10", type: "KYC", action: "View" },
                            { name: "Discretionary Mandate.pdf", date: "2020-01-15", type: "Mandate Docs", action: "View" },
                            { name: "Q1 2024 Statement.xlsx", date: "2024-04-05", type: "Statements", action: "Download" }
                        ]
                    },
                    {
                        accountId: "acc102",
                        accountType: "Non-Discretionary Account",
                        riskScore: 60,
                        aum: "40,000,000",
                        lastActivity: "2024-06-20",
                        portfolioBreakdown: {
                            labels: ['Fixed Income', 'Equities', 'Cash'],
                            data: [50, 30, 20]
                        },
                        portfolioValueChange: {
                            '1M': [4000000, 4020000, 4010000, 4050000],
                            '3M': [3800000, 3900000, 4000000, 4020000, 4010000, 4050000, 4080000, 4100000, 4120000, 4150000, 4180000, 4200000],
                            'YTD': [3500000, 3600000, 3700000, 3800000, 3900000, 4000000, 4020000, 4010000, 4050000, 4080000, 4100000, 4120000],
                            '1Y': [3000000, 3200000, 3400000, 3600000, 3800000, 4000000, 4020000, 4010000, 4050000, 4080000, 4100000, 4120000],
                            '3Y': [2000000, 2500000, 3000000, 3500000, 4000000, 4020000, 4010000, 4050000, 4080000, 4100000, 4120000, 4150000]
                        },
                        currentAllocation: [50, 30, 20],
                        strategicAllocation: [55, 25, 20],
                        allocationMovement: {
                            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                            equity: [30, 31, 30, 32, 33, 34],
                            fixedIncome: [55, 53, 54, 52, 51, 50]
                        },
                        sectorAllocation: {
                            labels: ['Government Bonds', 'Corporate Bonds', 'Utilities', 'Consumer Staples'],
                            data: [40, 30, 15, 10]
                        },
                        topHoldings: [
                            { name: "KSA Government Bond", weight: 10.0, return: 1.2, currency: "SAR" },
                            { name: "Etihad Airways Sukuk", weight: 8.0, return: 2.5, currency: "AED" },
                            { name: "Nestle SA", weight: 5.0, return: 1.5, currency: "CHF" },
                            { name: "Saudi Electric Co.", weight: 4.5, return: 0.9, currency: "SAR" },
                            { name: "Vodafone Group Plc", weight: 3.8, return: 0.7, currency: "GBP" }
                        ],
                        bottomHoldings: [
                            { name: "Small Cap Pharma", weight: 0.8, return: -3.0, currency: "USD" },
                            { name: "Emerging Market Equity", weight: 1.0, return: -1.5, currency: "USD" },
                            { name: "High Yield Bond Fund", weight: 1.2, return: -0.8, currency: "USD" },
                            { name: "Gold Futures", weight: 0.5, return: -2.0, currency: "USD" },
                            { name: "Local Bank Stock", weight: 1.5, return: 0.2, currency: "AED" }
                        ],
                        summary: {
                            creationDate: "2021-03-01",
                            mandateType: "Non-Discretionary",
                            custodianName: "XYZ Custody",
                            complianceStatus: "Compliant",
                            investmentGuidelines: "Client-directed investments, no speculative assets.",
                            currencyUsed: "SAR, AED"
                        },
                        historicalRiskScore: [65, 62, 60, 61, 58, 60],
                        alerts: [
                            { type: "Information", description: "Client recently requested a review of fixed income options.", severity: "Low" }
                        ],
                        cashLiquidity: {
                            availableCash: "2,500,000",
                            pendingInflows: "500,000 (Bond Coupons)",
                            pendingOutflows: "100,000 (Household Expenses)",
                            recommendedCashBuffer: "1,000,000",
                            upcomingRedemptions: "KSA Bond (SAR 1,000,000) - 2025-01-15"
                        },
                        transactions: [
                            { date: "2024-06-15", security: "KSA Government Bond", type: "Buy", quantity: 5, value: "500,000", currency: "SAR", status: "Completed" },
                            { date: "2024-06-01", security: "Etihad Airways Sukuk", type: "Sell", quantity: 10, value: "100,000", currency: "AED", status: "Completed" }
                        ],
                        documents: [
                            { name: "Non-Discretionary Agreement.pdf", date: "2021-02-20", type: "Mandate Docs", action: "View" },
                            { name: "Annual Statement 2023.pdf", date: "2024-01-10", type: "Statements", action: "Download" }
                        ]
                    },
                    {
                        accountId: "acc103",
                        accountType: "Joint Account with Spouse (Non-Discretionary)",
                        riskScore: 50,
                        aum: "20,000,000",
                        lastActivity: "2024-06-10",
                        portfolioBreakdown: {
                            labels: ['Fixed Income', 'Real Estate', 'Cash'],
                            data: [60, 25, 15]
                        },
                        portfolioValueChange: {
                            '1M': [2000000, 2010000, 2005000, 2020000],
                            '3M': [1900000, 1950000, 2000000, 2010000, 2005000, 2020000, 2030000, 2040000, 2050000, 2060000, 2070000, 2080000],
                            'YTD': [1800000, 1850000, 1900000, 1950000, 2000000, 2010000, 2005000, 2020000, 2030000, 2040000, 2050000, 2060000],
                            '1Y': [1700000, 1750000, 1800000, 1850000, 1900000, 2000000, 2010000, 2005000, 2020000, 2030000, 2040000, 2050000],
                            '3Y': [1500000, 1600000, 1700000, 1800000, 1900000, 2000000, 2010000, 2005000, 2020000, 2030000, 2040000, 2050000]
                        },
                        currentAllocation: [60, 25, 15],
                        strategicAllocation: [60, 20, 20],
                        allocationMovement: {
                            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                            equity: [10, 10, 10, 10, 10, 10],
                            fixedIncome: [60, 60, 60, 60, 60, 60]
                        },
                        sectorAllocation: {
                            labels: ['Real Estate', 'Government Bonds', 'Corporate Bonds'],
                            data: [25, 40, 20]
                        },
                        topHoldings: [
                            { name: "UAE Property REIT", weight: 15.0, return: 3.0, currency: "AED" },
                            { name: "Saudi Government Sukuk", weight: 12.0, return: 1.0, currency: "SAR" },
                            { name: "Dubai Fixed Income Fund", weight: 10.0, return: 1.8, currency: "AED" }
                        ],
                        bottomHoldings: [
                            { name: "Small Cap Equity", weight: 0.5, return: -0.5, currency: "USD" }
                        ],
                        summary: {
                            creationDate: "2019-08-01",
                            mandateType: "Non-Discretionary (Joint)",
                            custodianName: "First Gulf Custody",
                            complianceStatus: "Compliant",
                            investmentGuidelines: "Conservative growth, income generation, focus on real estate.",
                            currencyUsed: "AED"
                        },
                        historicalRiskScore: [55, 52, 50, 51, 48, 50],
                        alerts: [],
                        cashLiquidity: {
                            availableCash: "1,500,000",
                            pendingInflows: "200,000 (Rental Income)",
                            pendingOutflows: "50,000 (Property Maintenance)",
                            recommendedCashBuffer: "500,000",
                            upcomingRedemptions: "Dubai REIT (AED 1,000,000) - 2024-12-31"
                        },
                        transactions: [
                            { date: "2024-06-05", security: "UAE Property REIT", type: "Buy", quantity: 1000, value: "100,000", currency: "AED", status: "Completed" }
                        ],
                        documents: [
                            { name: "Joint Account Agreement.pdf", date: "2019-07-25", type: "Mandate Docs", action: "View" },
                            { name: "Property Deed.pdf", date: "2019-08-01", type: "Other", action: "Download" }
                        ]
                    },
                    {
                        accountId: "acc104",
                        accountType: "Joint Account with Children (Discretionary)",
                        riskScore: 70,
                        aum: "15,000,000",
                        lastActivity: "2024-06-25",
                        portfolioBreakdown: {
                            labels: ['Equities', 'Mutual Funds', 'Cash'],
                            data: [60, 30, 10]
                        },
                        portfolioValueChange: {
                            '1M': [1500000, 1510000, 1520000, 1530000],
                            '3M': [1400000, 1450000, 1500000, 1510000, 1520000, 1530000, 1540000, 1550000, 1560000, 1570000, 1580000, 1590000],
                            'YTD': [1300000, 1350000, 1400000, 1450000, 1500000, 1510000, 1520000, 1530000, 1540000, 1550000, 1560000, 1570000],
                            '1Y': [1200000, 1250000, 1300000, 1350000, 1400000, 1500000, 1510000, 1520000, 1530000, 1540000, 1550000, 1560000],
                            '3Y': [1000000, 1100000, 1200000, 1300000, 1400000, 1500000, 1510000, 1520000, 1530000, 1540000, 1550000, 1560000]
                        },
                        currentAllocation: [60, 30, 10],
                        strategicAllocation: [65, 25, 10],
                        allocationMovement: {
                            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                            equity: [55, 58, 60, 62, 60, 61],
                            mutualFunds: [35, 32, 30, 28, 30, 29]
                        },
                        sectorAllocation: {
                            labels: ['Global Tech', 'Healthcare', 'Education Funds', 'Consumer Discretionary'],
                            data: [30, 20, 25, 15]
                        },
                        topHoldings: [
                            { name: "Global Islamic Tech Fund", weight: 10.0, return: 5.0, currency: "USD" },
                            { name: "Children's Education Mutual Fund", weight: 8.0, return: 3.5, currency: "USD" },
                            { name: "Alphabet Inc.", weight: 7.0, return: 6.0, currency: "USD" }
                        ],
                        bottomHoldings: [
                            { name: "Local SME Equity", weight: 1.0, return: -1.0, currency: "AED" }
                        ],
                        summary: {
                            creationDate: "2022-05-01",
                            mandateType: "Discretionary (Joint)",
                            custodianName: "Global Trust Bank",
                            complianceStatus: "Compliant",
                            investmentGuidelines: "Long-term growth for education, moderate risk.",
                            currencyUsed: "USD"
                        },
                        historicalRiskScore: [68, 70, 69, 71, 70, 70],
                        alerts: [],
                        cashLiquidity: {
                            availableCash: "1,000,000",
                            pendingInflows: "100,000 (Parent Contribution)",
                            pendingOutflows: "50,000 (School Fees)",
                            recommendedCashBuffer: "200,000",
                            upcomingRedemptions: "None"
                        },
                        transactions: [
                            { date: "2024-06-20", security: "Global Islamic Tech Fund", type: "Buy", quantity: 50, value: "5,000", currency: "USD", status: "Completed" }
                        ],
                        documents: [
                            { name: "Joint Account for Minors.pdf", date: "2022-04-20", type: "Mandate Docs", action: "View" },
                            { name: "Education Savings Plan.pdf", date: "2022-05-01", type: "Other", action: "Download" }
                        ]
                    }
                ]
            },
            client2: {
                id: "client2",
                name: "Mrs. Aisha Khan",
                aum: "75,000,000",
                rm: "Jane Doe",
                email: "aisha.khan@example.com",
                phone: "+966 55 987 6543",
                risk: "Moderate",
                goals: "Retirement Planning, Child's Education",
                assets: "80,000,000",
                liabilities: "5,000,000",
                netWorth: "75,000,000",
                accounts: [
                    {
                        accountId: "acc201",
                        accountType: "Retirement Savings Account",
                        riskScore: 55,
                        aum: "60,000,000",
                        lastActivity: "2024-06-29",
                        portfolioBreakdown: {
                            labels: ['Fixed Income', 'Equities', 'Real Estate', 'Cash'],
                            data: [40, 35, 15, 10]
                        },
                        portfolioValueChange: {
                            '1M': [6000000, 6050000, 6100000, 6120000],
                            '3M': [5800000, 5900000, 6000000, 6050000, 6100000, 6120000, 6150000, 6180000, 6200000, 6250000, 6280000, 6300000],
                            'YTD': [5500000, 5600000, 5700000, 5800000, 5900000, 6000000, 6050000, 6100000, 6120000, 6150000, 6180000, 6200000],
                            '1Y': [5000000, 5200000, 5400000, 5600000, 5800000, 6000000, 6050000, 6100000, 6120000, 6150000, 6180000, 6200000],
                            '3Y': [4000000, 4500000, 5000000, 5500000, 6000000, 6050000, 6100000, 6120000, 6150000, 6180000, 6200000, 6250000]
                        },
                        currentAllocation: [40, 35, 15, 10],
                        strategicAllocation: [45, 30, 15, 10],
                        allocationMovement: {
                            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                            equity: [30, 32, 33, 35, 34, 36],
                            fixedIncome: [45, 43, 42, 40, 41, 39]
                        },
                        sectorAllocation: {
                            labels: ['Utilities', 'Healthcare', 'Consumer Staples', 'Financials'],
                            data: [20, 25, 18, 15]
                        },
                        topHoldings: [
                            { name: "KSA Retirement Sukuk", weight: 9.0, return: 1.5, currency: "SAR" },
                            { name: "Global Dividend Equity Fund", weight: 7.5, return: 4.0, currency: "USD" },
                            { name: "Saudi Real Estate Income", weight: 6.0, return: 2.0, currency: "SAR" }
                        ],
                        bottomHoldings: [
                            { name: "Emerging Market Equity Fund", weight: 1.0, return: -1.2, currency: "USD" }
                        ],
                        summary: {
                            creationDate: "2018-07-01",
                            mandateType: "Discretionary",
                            custodianName: "KSA Wealth Custody",
                            complianceStatus: "Compliant",
                            investmentGuidelines: "Long-term retirement growth, moderate risk, income focus.",
                            currencyUsed: "SAR"
                        },
                        historicalRiskScore: [50, 52, 55, 53, 56, 55],
                        alerts: [],
                        cashLiquidity: {
                            availableCash: "3,000,000",
                            pendingInflows: "800,000 (Pension Contributions)",
                            pendingOutflows: "150,000 (Scheduled Withdrawals)",
                            recommendedCashBuffer: "1,500,000",
                            upcomingRedemptions: "None"
                        },
                        transactions: [
                            { date: "2024-06-20", security: "Global Dividend Equity Fund", type: "Buy", quantity: 200, value: "20,000", currency: "USD", status: "Completed" },
                            { date: "2024-06-10", security: "KSA Retirement Sukuk", type: "Buy", quantity: 10, value: "1,000,000", currency: "SAR", status: "Completed" }
                        ],
                        documents: [
                            { name: "Retirement Plan Agreement.pdf", date: "2018-06-25", type: "Mandate Docs", action: "View" },
                            { name: "Q2 2024 Statement.pdf", date: "2024-07-01", type: "Statements", action: "Download" }
                        ]
                    },
                    {
                        accountId: "acc202",
                        accountType: "Education Savings Account",
                        riskScore: 65,
                        aum: "15,000,000",
                        lastActivity: "2024-06-27",
                        portfolioBreakdown: {
                            labels: ['Equities', 'Mutual Funds', 'Cash'],
                            data: [55, 30, 15]
                        },
                        portfolioValueChange: {
                            '1M': [1500000, 1510000, 1520000, 1530000],
                            '3M': [1400000, 1450000, 1500000, 1510000, 1520000, 1530000, 1540000, 1550000, 1560000, 1570000, 1580000, 1590000],
                            'YTD': [1300000, 1350000, 1400000, 1450000, 1500000, 1510000, 1520000, 1530000, 1540000, 1550000, 1560000, 1570000],
                            '1Y': [1200000, 1250000, 1300000, 1350000, 1400000, 1500000, 1510000, 1520000, 1530000, 1540000, 1550000, 1560000],
                            '3Y': [1000000, 1100000, 1200000, 1300000, 1400000, 1500000, 1510000, 1520000, 1530000, 1540000, 1550000, 1560000]
                        },
                        currentAllocation: [55, 30, 15],
                        strategicAllocation: [60, 25, 15],
                        allocationMovement: {
                            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                            equity: [50, 52, 53, 55, 54, 56],
                            mutualFunds: [35, 33, 32, 30, 31, 29]
                        },
                        sectorAllocation: {
                            labels: ['Education Services', 'Technology', 'Healthcare', 'Consumer Discretionary'],
                            data: [30, 20, 15, 10]
                        },
                        topHoldings: [
                            { name: "Global Education Fund", weight: 12.0, return: 4.5, currency: "USD" },
                            { name: "Tech Growth ETF", weight: 9.0, return: 6.0, currency: "USD" },
                            { name: "Saudi Telecom Co.", weight: 7.0, return: 2.5, currency: "SAR" }
                        ],
                        bottomHoldings: [
                            { name: "Local Small Cap", weight: 0.7, return: -0.8, currency: "SAR" }
                        ],
                        summary: {
                            creationDate: "2020-09-10",
                            mandateType: "Discretionary",
                            custodianName: "KSA Wealth Custody",
                            complianceStatus: "Compliant",
                            investmentGuidelines: "Aggressive growth for child's university, long horizon.",
                            currencyUsed: "USD, SAR"
                        },
                        historicalRiskScore: [60, 62, 65, 63, 66, 65],
                        alerts: [],
                        cashLiquidity: {
                            availableCash: "1,000,000",
                            pendingInflows: "100,000 (Monthly Contribution)",
                            pendingOutflows: "0",
                            recommendedCashBuffer: "200,000",
                            upcomingRedemptions: "None"
                        },
                        transactions: [
                            { date: "2024-06-25", security: "Global Education Fund", type: "Buy", quantity: 100, value: "10,000", currency: "USD", status: "Completed" }
                        ],
                        documents: [
                            { name: "Education Savings Plan.pdf", date: "2020-09-01", type: "Mandate Docs", action: "View" },
                            { name: "Child's Birth Certificate.pdf", date: "2020-09-01", type: "KYC", action: "View" }
                        ]
                    }
                ]
            }
        };

        let currentClientId = null;
        let currentAccountId = null;

        // Chart instances holder
        let portfolioAllocationChart, assetClassPerformanceChart, cumulativeFlowsChart, shariahProductPerformanceChart,
            clientPortfolioPerformanceChart, clientCashFlowChart,
            accountPortfolioBreakdownChart, accountPortfolioValueChangeChart, accountAllocationComparisonChart,
            accountAllocationMovementChart, accountSectorAllocationChart, accountHistoricalRiskChart;

        // Dummy data for Top Clients on Dashboard
        const dashboardTopClientsData = [
            { clientName: "A. Al-Farsi", aum: 150000000, netFlows: 5000000, performance: 12.5, numAccounts: 4 },
            { clientName: "M. Al-Qahtani", aum: 120000000, netFlows: 3000000, performance: 10.2, numAccounts: 2 },
            { clientName: "S. Mansour", aum: 95000000, netFlows: -1000000, performance: 8.8, numAccounts: 3 },
            { clientName: "F. Al-Hammadi", aum: 80000000, netFlows: 2000000, performance: 9.5, numAccounts: 2 },
            { clientName: "N. Al-Dossari", aum: 70000000, netFlows: 1500000, performance: 11.0, numAccounts: 1 }
        ];

        let currentTopClientsSortKey = 'clientName';
        let currentTopClientsSortDirection = 'asc'; // 'asc' or 'desc'

        // Function to destroy existing chart instances
        function destroyCharts() {
            if (portfolioAllocationChart) { portfolioAllocationChart.destroy(); portfolioAllocationChart = null; }
            if (assetClassPerformanceChart) { assetClassPerformanceChart.destroy(); assetClassPerformanceChart = null; }
            if (cumulativeFlowsChart) { cumulativeFlowsChart.destroy(); cumulativeFlowsChart = null; } // Destroy cumulative flows chart
            if (shariahProductPerformanceChart) { shariahProductPerformanceChart.destroy(); shariahProductPerformanceChart = null; }
            if (clientPortfolioPerformanceChart) { clientPortfolioPerformanceChart.destroy(); clientPortfolioPerformanceChart = null; }
            if (clientCashFlowChart) { clientCashFlowChart.destroy(); clientCashFlowChart = null; }
            // New account-specific charts
            if (accountPortfolioBreakdownChart) { accountPortfolioBreakdownChart.destroy(); accountPortfolioBreakdownChart = null; }
            if (accountPortfolioValueChangeChart) { accountPortfolioValueChangeChart.destroy(); accountPortfolioValueChangeChart = null; }
            if (accountAllocationComparisonChart) { accountAllocationComparisonChart.destroy(); accountAllocationComparisonChart = null; }
            if (accountAllocationMovementChart) { accountAllocationMovementChart.destroy(); accountAllocationMovementChart = null; }
            if (accountSectorAllocationChart) { accountSectorAllocationChart.destroy(); accountSectorAllocationChart = null; }
            if (accountHistoricalRiskChart) { accountHistoricalRiskChart.destroy(); accountHistoricalRiskChart = null; }
        }

        // Dark Mode Toggle
        const darkModeToggle = document.getElementById('dark-mode-toggle');
        const htmlElement = document.documentElement;

        // Function to get chart colors based on theme
        function getChartColors() {
            const isDarkMode = htmlElement.classList.contains('dark');
            return {
                isDarkMode: isDarkMode, // Added for direct use
                textColor: isDarkMode ? '#d1d5db' : '#374151', // gray-300 or gray-700
                gridColor: isDarkMode ? '#4b5563' : '#e5e7eb', // gray-600 or gray-200
                pieColors: ['#4299e1', '#63b3ed', '#8daddf', '#a0aec0', '#48bb78', '#f6ad55', '#e53e3e', '#805ad5'], // blue shades, green, orange, red, purple
                barColors: ['#48bb78', '#63b3ed', '#805ad5', '#f6ad55', '#e53e3e'], // Green, Blue, Purple, Orange, Red
                lineColor: '#3182ce',
                lineFillColor: 'rgba(49, 130, 206, 0.2)',
                shariahLineColor: '#48bb78',
                shariahLineFillColor: 'rgba(72, 187, 120, 0.2)',
                cashFlowPositive: 'rgba(75, 192, 192, 0.7)',
                cashFlowNegative: 'rgba(255, 99, 132, 0.7)',
                cashFlowBorderPositive: 'rgba(75, 192, 192, 1)',
                cashFlowBorderNegative: 'rgba(255, 99, 132, 1)',
                cumulativeFlowColors: [ // For the area chart lines/fills
                    'rgba(72, 187, 120, 0.7)', // Equities (Green)
                    'rgba(66, 153, 225, 0.7)', // Sukuk (Blue)
                    'rgba(128, 90, 213, 0.7)', // Mutual Funds & ETFs (Purple)
                    'rgba(246, 173, 85, 0.7)', // Real Estate/REITs (Orange)
                    'rgba(237, 100, 100, 0.7)', // Commodities (Red)
                    'rgba(100, 116, 139, 0.7)' // Private Equity/VC (Slate/Gray)
                ],
                 cumulativeFlowBorders: [ // For the area chart lines/fills
                    'rgb(72, 187, 120)', // Equities (Green)
                    'rgb(66, 153, 225)', // Sukuk (Blue)
                    'rgb(128, 90, 213)', // Mutual Funds & ETFs (Purple)
                    'rgb(246, 173, 85)', // Real Estate/REITs (Orange)
                    'rgb(237, 100, 100)', // Commodities (Red)
                    'rgb(100, 116, 139)' // Private Equity/VC (Slate/Gray)
                ],
                // Colors for risk gauge
                riskLow: '#48bb78',    // Green
                riskMedium: '#f6ad55', // Orange
                riskHigh: '#e53e3e'    // Red
            };
        }

        // Function to update chart colors
        function updateChartTheme(chart) {
            if (chart) {
                const colors = getChartColors();
                chart.options.scales = {
                    x: {
                        ticks: { color: colors.textColor },
                        grid: { color: colors.gridColor }
                    },
                    y: {
                        ticks: { color: colors.textColor },
                        grid: { color: colors.gridColor }
                    }
                };
                if (chart.options.plugins && chart.options.plugins.legend) {
                    chart.options.plugins.legend.labels.color = colors.textColor;
                }
                // Specific updates for pie chart border
                if (chart.config.type === 'pie' && chart.data.datasets.length > 0) {
                    chart.data.datasets[0].borderColor = colors.isDarkMode ? '#2d3748' : '#ffffff';
                }
                // Specific updates for bar chart background and border
                if (chart.config.type === 'bar' && chart.data.datasets.length > 0) {
                    // This applies to fixed-color bar charts
                    if (chart.canvas.id !== 'clientCashFlowChart') { // Avoid changing colors for cash flow chart
                         chart.data.datasets[0].borderColor = colors.isDarkMode ? '#2d3748' : '#ffffff';
                    }
                }


                // Special handling for cash flow chart where colors depend on value
                if (chart.canvas.id === 'clientCashFlowChart' && chart.data.datasets.length > 0) {
                    chart.data.datasets[0].backgroundColor = chart.data.datasets[0].data.map(value => value >= 0 ? colors.cashFlowPositive : colors.cashFlowNegative);
                    chart.data.datasets[0].borderColor = chart.data.datasets[0].data.map(value => value >= 0 ? colors.cashFlowBorderPositive : colors.cashFlowBorderNegative);
                }

                chart.update();
            }
        }

        // Apply initial theme
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            htmlElement.classList.add('dark');
            darkModeToggle.checked = true;
        } else {
            htmlElement.classList.remove('dark');
            darkModeToggle.checked = false;
        }

        darkModeToggle.addEventListener('change', () => {
            if (darkModeToggle.checked) {
                htmlElement.classList.add('dark');
                localStorage.theme = 'dark';
            } else {
                localStorage.theme = 'light';
                htmlElement.classList.remove('dark');
            }
            // Update all active charts with new theme colors
            if (portfolioAllocationChart) updateChartTheme(portfolioAllocationChart);
            if (assetClassPerformanceChart) updateChartTheme(assetClassPerformanceChart);
            if (cumulativeFlowsChart) updateChartTheme(cumulativeFlowsChart); // Update cumulative flows chart
            if (shariahProductPerformanceChart) updateChartTheme(shariahProductPerformanceChart);
            if (clientPortfolioPerformanceChart) updateChartTheme(clientPortfolioPerformanceChart);
            if (clientCashFlowChart) updateChartTheme(clientCashFlowChart);
            // New account-specific charts
            if (accountPortfolioBreakdownChart) updateChartTheme(accountPortfolioBreakdownChart);
            if (accountPortfolioValueChangeChart) updateChartTheme(accountPortfolioValueChangeChart);
            if (accountAllocationComparisonChart) updateChartTheme(accountAllocationComparisonChart);
            if (accountAllocationMovementChart) updateChartTheme(accountAllocationMovementChart);
            if (accountSectorAllocationChart) updateChartTheme(accountSectorAllocationChart);
            if (accountHistoricalRiskChart) updateChartTheme(accountHistoricalRiskChart);

            // Update risk gauge color
            updateRiskGaugeColor(currentAccountData ? currentAccountData.riskScore : 0);
        });

        // Navigation Logic
        const navLinks = document.querySelectorAll('.nav-link');
        const contentViews = document.querySelectorAll('.content-view');
        const pageTitle = document.getElementById('page-title');
        const productsCartIcon = document.getElementById('products-cart-icon');

        function activateNavLink(targetId) {
            navLinks.forEach(nav => {
                nav.classList.remove('active-nav', 'bg-blue-100', 'text-blue-700', 'dark:bg-blue-100', 'dark:text-blue-400');
                nav.classList.add('text-gray-700', 'hover:bg-blue-100', 'hover:text-blue-700', 'dark:text-gray-300');
            });

            const currentActiveLink = document.querySelector(`.nav-link[data-target="${targetId}"]`);
            if (currentActiveLink) {
                currentActiveLink.classList.add('active-nav', 'bg-blue-100', 'text-blue-700');
                currentActiveLink.classList.remove('text-gray-700', 'hover:bg-blue-100', 'hover:text-blue-700');
                if (htmlElement.classList.contains('dark')) {
                    currentActiveLink.classList.add('dark:bg-blue-100', 'dark:text-blue-400');
                    currentActiveLink.classList.remove('dark:text-gray-300');
                }
            }
        }

        navLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const targetId = this.dataset.target;

                // Destroy existing charts before switching views to prevent rendering issues
                destroyCharts();

                contentViews.forEach(view => view.classList.add('hidden'));

                const targetView = document.getElementById(targetId);
                if (targetView) {
                    targetView.classList.remove('hidden');
                    pageTitle.textContent = this.querySelector('span').textContent;
                    activateNavLink(targetId);

                    // Show/hide cart icon based on view
                    if (targetId === 'products-view') {
                        productsCartIcon.classList.remove('hidden');
                        renderProducts(); // Re-render products with filters
                        initCumulativeFlowsChart(); // Initialize new cumulative flows chart
                        // Automatically trigger Performance view by default
                        document.getElementById('products-performance-toggle').click();
                    } else {
                        productsCartIcon.classList.add('hidden');
                    }

                    // Initialize charts for the newly active view
                    if (targetId === 'dashboard-view') {
                        initDashboardCharts();
                        renderTopClientsTable(); // Render top clients table for dashboard
                    }
                    if (targetId === 'clients-list-view') {
                        renderClientsList();
                    }
                }

                if (targetId === 'clients-list-view') {
                    document.getElementById('client-360-view').classList.add('hidden');
                    document.getElementById('account-dashboard-view').classList.add('hidden'); // Hide account dashboard
                }
            });
        });

        // Function to show Clients List and hide Client 360 View and Account Dashboard View
        function showClientsList() {
            destroyCharts(); // Destroy charts when moving back
            document.getElementById('client-360-view').classList.add('hidden');
            document.getElementById('account-dashboard-view').classList.add('hidden');
            document.getElementById('clients-list-view').classList.remove('hidden');
            productsCartIcon.classList.add('hidden'); // Hide cart icon
            pageTitle.textContent = "Clients";
            activateNavLink('clients-list-view');
            renderClientsList(); // Re-render client list to ensure state is correct
        }

        // Function to show Client 360 View from Account Dashboard
        function showClient360FromAccount() {
            destroyCharts(); // Destroy account dashboard charts
            document.getElementById('account-dashboard-view').classList.add('hidden');
            document.getElementById('client-360-view').classList.remove('hidden');
            // Re-activate the correct client 360 tab
            const overviewTabBtn = document.querySelector('.tab-button[data-tab="overview"]');
            if (overviewTabBtn) overviewTabBtn.click(); // Simulate click to re-initialize
            pageTitle.textContent = clients[currentClientId].name; // Restore client name in header
        }

        // Client 360 View Tab Logic
        const tabButtons = document.querySelectorAll('.tab-button');
        const tabContents = document.querySelectorAll('.tab-content');

        tabButtons.forEach(button => {
            button.addEventListener('click', function() {
                tabButtons.forEach(btn => btn.classList.remove('active-tab', 'border-blue-500', 'text-blue-600', 'dark:border-blue-400', 'dark:text-blue-400'));
                tabButtons.forEach(btn => btn.classList.add('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300', 'font-medium', 'text-sm', 'dark:text-gray-400', 'dark:hover:text-gray-300', 'dark:hover:border-gray-500'));

                tabContents.forEach(content => content.classList.add('hidden'));

                this.classList.add('active-tab', 'border-blue-500', 'text-blue-600', 'dark:border-blue-400', 'dark:text-blue-400');
                this.classList.remove('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300', 'dark:text-gray-400', 'dark:hover:text-gray-300', 'dark:hover:border-gray-500');

                document.getElementById(`${this.dataset.tab}-tab-content`).classList.remove('hidden');

                // Initialize charts if portfolio tab is active
                if (this.dataset.tab === 'portfolio') {
                    initClientPortfolioCharts();
                } else {
                    // Destroy client portfolio charts if switching away
                    if (clientPortfolioPerformanceChart) { clientPortfolioPerformanceChart.destroy(); clientPortfolioPerformanceChart = null; }
                    if (clientCashFlowChart) { clientCashFlowChart.destroy(); clientCashFlowChart = null; }
                }
            });
        });

        // Account Dashboard Tab Logic
        const accountTabButtons = document.querySelectorAll('.account-tab-button');
        const accountTabContents = document.querySelectorAll('.account-tab-content');
        let currentAccountData = null; // To hold the data of the currently displayed account

        accountTabButtons.forEach(button => {
            button.addEventListener('click', function() {
                accountTabButtons.forEach(btn => btn.classList.remove('active-tab', 'border-blue-500', 'text-blue-600', 'dark:border-blue-400', 'dark:text-blue-400'));
                accountTabButtons.forEach(btn => btn.classList.add('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300', 'font-medium', 'text-sm', 'dark:text-gray-400', 'dark:hover:text-gray-300', 'dark:hover:border-gray-500'));

                accountTabContents.forEach(content => content.classList.add('hidden'));

                this.classList.add('active-tab', 'border-blue-500', 'text-blue-600', 'dark:border-blue-400', 'dark:text-blue-400');
                this.classList.remove('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300', 'dark:text-gray-400', 'dark:hover:text-gray-300', 'dark:hover:border-gray-500');

                const targetTabContent = document.getElementById(`${this.dataset.tab}-tab-content`);
                if (targetTabContent) {
                    targetTabContent.classList.remove('hidden');
                }

                // Initialize/update charts and content based on the active account tab
                destroyAccountCharts(); // Destroy all account charts before initializing new ones
                if (currentAccountData) {
                    switch (this.dataset.tab) {
                        case 'portfolio-overview':
                            initAccountPortfolioCharts(currentAccountData);
                            populateHoldingsTables(currentAccountData.topHoldings, currentAccountData.bottomHoldings);
                            break;
                        case 'account-summary':
                            populateAccountSummary(currentAccountData);
                            break;
                        case 'risk-alerts':
                            initAccountRiskCharts(currentAccountData);
                            populateRiskAlerts(currentAccountData);
                            break;
                        case 'cash-liquidity':
                            populateCashLiquidity(currentAccountData);
                            break;
                        case 'recent-transactions':
                            populateRecentTransactions(currentAccountData);
                            break;
                        case 'account-documents':
                            populateAccountDocuments(currentAccountData);
                            break;
                    }
                }
            });
        });

        // Function to display client details in 360 view
        function displayClient360(clientId) {
            currentClientId = clientId; // Set current client ID
            const client = clients[clientId];
            if (client) {
                document.getElementById('client-name-display').textContent = client.name;
                document.getElementById('client-aum-display').textContent = `AUM: $${client.aum.toLocaleString()}`;
                document.getElementById('client-rm-display').textContent = `RM: ${client.rm}`;
                document.getElementById('client-email-display').textContent = client.email;
                document.getElementById('client-phone-display').textContent = client.phone;
                document.getElementById('client-risk-display').textContent = client.risk;
                document.getElementById('client-goals-display').textContent = client.goals;
                document.getElementById('client-assets-display').textContent = client.assets.toLocaleString();
                document.getElementById('client-liabilities-display').textContent = client.liabilities.toLocaleString();
                document.getElementById('client-networth-display').textContent = client.netWorth.toLocaleString();

                destroyCharts(); // Destroy dashboard/product charts

                contentViews.forEach(view => view.classList.add('hidden'));
                document.getElementById('client-360-view').classList.remove('hidden');
                productsCartIcon.classList.add('hidden'); // Hide cart icon
                pageTitle.textContent = client.name;
                activateNavLink('clients-list-view'); // Highlight Clients in sidebar

                // Reset to overview tab by default and initialize its charts
                tabButtons.forEach(btn => btn.classList.remove('active-tab', 'border-blue-500', 'text-blue-600', 'dark:border-blue-400', 'dark:text-blue-400'));
                tabButtons.forEach(btn => btn.classList.add('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300', 'font-medium', 'text-sm', 'dark:text-gray-400', 'dark:hover:text-gray-300', 'dark:hover:border-gray-500'));
                
                const overviewTabBtn = document.querySelector('.tab-button[data-tab="overview"]');
                const overviewTabContent = document.getElementById('overview-tab-content');

                if (overviewTabBtn && overviewTabContent) {
                    overviewTabBtn.classList.add('active-tab', 'border-blue-500', 'text-blue-600', 'dark:border-blue-400', 'dark:text-blue-400');
                    overviewTabBtn.classList.remove('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300', 'dark:text-gray-400', 'dark:hover:text-gray-300', 'dark:hover:border-gray-500');
                    overviewTabContent.classList.remove('hidden');
                }

                // If user lands directly on a client, no portfolio charts are immediately initialized unless the tab is clicked.
            }
        }

        // Function to display specific account dashboard
        function displayAccountDashboard(clientId, accountId) {
            currentClientId = clientId;
            currentAccountId = accountId;
            const client = clients[clientId];
            const account = client.accounts.find(acc => acc.accountId === accountId);

            if (client && account) {
                currentAccountData = account; // Store current account data globally

                document.getElementById('account-name-display').textContent = account.accountType;
                document.getElementById('account-aum-display').textContent = `AUM: $${account.aum.toLocaleString()}`;
                document.getElementById('account-type-display').textContent = `Type: ${account.accountType}`;

                destroyCharts(); // Destroy all other charts

                contentViews.forEach(view => view.classList.add('hidden'));
                document.getElementById('account-dashboard-view').classList.remove('hidden');
                productsCartIcon.classList.add('hidden');
                pageTitle.textContent = `${client.name} - ${account.accountType}`;
                activateNavLink('clients-list-view'); // Keep Clients highlighted

                // Reset to Portfolio Overview tab by default and initialize its charts/content
                accountTabButtons.forEach(btn => btn.classList.remove('active-tab', 'border-blue-500', 'text-blue-600', 'dark:border-blue-400', 'dark:text-blue-400'));
                accountTabButtons.forEach(btn => btn.classList.add('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300', 'font-medium', 'text-sm', 'dark:text-gray-400', 'dark:hover:text-gray-300', 'dark:hover:border-gray-500'));
                
                const portfolioOverviewTabBtn = document.querySelector('.account-tab-button[data-tab="portfolio-overview"]');
                const portfolioOverviewTabContent = document.getElementById('portfolio-overview-tab-content');

                if (portfolioOverviewTabBtn && portfolioOverviewTabContent) {
                    portfolioOverviewTabBtn.classList.add('active-tab', 'border-blue-500', 'text-blue-600', 'dark:border-blue-400', 'dark:text-blue-400');
                    portfolioOverviewTabBtn.classList.remove('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300', 'dark:text-gray-400', 'dark:hover:text-gray-300', 'dark:hover:border-gray-500');
                    portfolioOverviewTabContent.classList.remove('hidden');
                    initAccountPortfolioCharts(account); // Initialize charts for the active account
                    populateHoldingsTables(account.topHoldings, account.bottomHoldings);
                }
            }
        }

        // --- Client List Rendering with Accounts ---
        const clientsTableContainer = document.getElementById('clients-table-container');

        function renderClientsList() {
            clientsTableContainer.innerHTML = ''; // Clear existing content

            for (const clientId in clients) {
                const client = clients[clientId];
                const clientRowHtml = `
                    <div class="bg-white dark:bg-gray-700 rounded-lg shadow-sm border border-gray-200 dark:border-gray-600 mb-3 overflow-hidden">
                        <div class="flex items-center justify-between p-4 cursor-pointer client-header" data-client-id="${client.id}">
                            <div class="flex items-center">
                                <i class="fas fa-plus-circle text-blue-500 mr-3 expand-icon"></i>
                                <a href="#" class="client-link text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-500 font-medium" data-client-id="${client.id}">${client.name}</a>
                            </div>
                            <div class="flex items-center space-x-4 text-sm text-gray-700 dark:text-gray-300">
                                <span>AUM: $${client.aum.toLocaleString()}</span>
                                <span>Risk: ${client.risk}</span>
                                <span>Last Contact: ${client.lastActivity || 'N/A'}</span>
                                <a href="#" class="text-indigo-600 dark:text-indigo-400 hover:text-indigo-900 dark:hover:text-indigo-600">Edit</a>
                            </div>
                        </div>
                        <div id="client-accounts-${client.id}" class="hidden bg-gray-50 dark:bg-gray-800 p-4 border-t border-gray-200 dark:border-gray-600">
                            <h5 class="text-md font-semibold text-gray-800 dark:text-gray-100 mb-3">Client Accounts:</h5>
                            <div class="space-y-3">
                                ${client.accounts.map(account => `
                                    <div class="flex flex-wrap items-center justify-between p-3 bg-white dark:bg-gray-700 rounded-lg shadow-sm border border-gray-200 dark:border-gray-600 text-sm">
                                        <div class="flex-grow grid grid-cols-1 md:grid-cols-3 gap-2">
                                            <p class="text-gray-700 dark:text-gray-300"><strong class="text-gray-800 dark:text-gray-200">Type:</strong> ${account.accountType}</p>
                                            <p class="text-gray-700 dark:text-gray-300"><strong class="text-gray-800 dark:text-gray-200">Risk Score:</strong> ${account.riskScore}</p>
                                            <p class="text-gray-700 dark:text-gray-300"><strong class="text-gray-800 dark:text-gray-200">AUM:</strong> $${account.aum.toLocaleString()}</p>
                                            <p class="text-gray-700 dark:text-gray-300 md:col-span-3"><strong class="text-gray-800 dark:text-gray-200">Last Activity:</strong> ${account.lastActivity}</p>
                                        </div>
                                        <button class="view-account-btn mt-3 md:mt-0 bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors duration-200 shadow-md text-xs"
                                                data-client-id="${client.id}" data-account-id="${account.accountId}">
                                            View Account
                                        </button>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
                clientsTableContainer.insertAdjacentHTML('beforeend', clientRowHtml);
            }

            // Add event listeners for expand/collapse icons
            document.querySelectorAll('.client-header').forEach(header => {
                header.addEventListener('click', function() {
                    const clientId = this.dataset.clientId;
                    const accountsDiv = document.getElementById(`client-accounts-${clientId}`);
                    const icon = this.querySelector('.expand-icon');
                    if (accountsDiv.classList.contains('hidden')) {
                        accountsDiv.classList.remove('hidden');
                        icon.classList.remove('fa-plus-circle');
                        icon.classList.add('fa-minus-circle');
                    } else {
                        accountsDiv.classList.add('hidden');
                        icon.classList.remove('fa-minus-circle');
                        icon.classList.add('fa-plus-circle');
                    }
                });
            });

            // Add event listeners for "View Account" buttons
            document.querySelectorAll('.view-account-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const clientId = this.dataset.clientId;
                    const accountId = this.dataset.accountId;
                    displayAccountDashboard(clientId, accountId);
                });
            });

             // Event listeners for client links in the list (for client 360 view)
            document.querySelectorAll('.client-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault(); // Prevent default link behavior
                    const clientId = this.dataset.clientId;
                    displayClient360(clientId);
                });
            });
        }


        // Initialize Dashboard Charts
        function initDashboardCharts() {
            const colors = getChartColors();

            // Portfolio Allocation Pie Chart
            const ctxPortfolio = document.getElementById('portfolioAllocationChart').getContext('2d');
            portfolioAllocationChart = new Chart(ctxPortfolio, {
                type: 'pie',
                data: {
                    labels: ['Equities', 'Fixed Income', 'Alternatives', 'Cash', 'Mutual Funds'],
                    datasets: [{
                        data: [40, 25, 15, 10, 10], // Adjusted data for Mutual Funds
                        backgroundColor: colors.pieColors,
                        borderColor: colors.isDarkMode ? '#2d3748' : '#ffffff',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                color: colors.textColor
                            }
                        },
                        title: {
                            display: false
                        }
                    },
                    animation: {
                        animateRotate: true,
                        animateScale: true
                    }
                }
            });

            // Portfolio Allocation Filter Dropdown Logic (Placeholder)
            const portfolioAllocationFilter = document.getElementById('portfolio-allocation-filter');
            portfolioAllocationFilter.addEventListener('change', function() {
                const selectedFilter = this.value;
                console.log('Portfolio Allocation Filter selected:', selectedFilter);
                // Placeholder: In a real app, you'd update chart data based on this filter
                // For example:
                // if (selectedFilter === 'geography') {
                //     portfolioAllocationChart.data.labels = ['MENA', 'SEA', 'Africa'];
                //     portfolioAllocationChart.data.datasets[0].data = [50, 30, 20];
                // }
                // portfolioAllocationChart.update();
            });


            // Asset Class Performance Bar Chart
            const ctxAsset = document.getElementById('assetClassPerformanceChart').getContext('2d');
            assetClassPerformanceChart = new Chart(ctxAsset, {
                type: 'bar',
                data: {
                    labels: ['Equities', 'Fixed Income', 'Alternatives', 'Real Estate', 'Commodities'],
                    datasets: [{
                        label: 'YTD Performance (%)',
                        data: [10.5, 3.2, 7.8, 5.0, 3.1],
                        backgroundColor: colors.barColors,
                        borderColor: colors.isDarkMode ? '#2d3748' : '#ffffff',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false,
                        },
                        title: {
                            display: false,
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: colors.textColor },
                            grid: { color: colors.gridColor }
                        },
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: colors.textColor,
                                callback: function(value) { return value + '%'; }
                            },
                            grid: { color: colors.gridColor }
                        }
                    },
                    animation: {
                        duration: 1000
                    }
                }
            });
        }

        // Initialize Cumulative Flows Area Chart
        function initCumulativeFlowsChart() {
            const colors = getChartColors();
            const ctxFlows = document.getElementById('cumulativeFlowsChart').getContext('2d');
            
            // Generate cumulative data for each category
            const categories = ["Equities", "Sukuk", "Mutual Funds & ETFs", "Real Estate/REITs", "Commodities", "Private Equity/VC"];
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            const cumulativeData = {};
            const initialFlows = {
                "Equities": 500000,
                "Sukuk": 300000,
                "Mutual Funds & ETFs": 400000,
                "Real Estate/REITs": 250000,
                "Commodities": 100000,
                "Private Equity/VC": 200000
            };

            categories.forEach(cat => {
                cumulativeData[cat] = [];
                let currentCumulative = initialFlows[cat] || 0;
                for (let i = 0; i < 12; i++) {
                    const monthlyChange = Math.random() * 100000 - 40000; // Random inflow/outflow
                    currentCumulative += monthlyChange;
                    cumulativeData[cat].push(Math.round(currentCumulative / 1000) * 1000); // Round to nearest 1000
                }
            });

            const datasets = categories.map((cat, index) => ({
                label: cat,
                data: cumulativeData[cat],
                borderColor: colors.cumulativeFlowBorders[index],
                backgroundColor: colors.cumulativeFlowColors[index],
                fill: true,
                tension: 0.4, // Smooth curves
                pointRadius: 0 // No points
            }));

            cumulativeFlowsChart = new Chart(ctxFlows, {
                type: 'line', // Line chart with fill for Area Chart effect
                data: {
                    labels: months,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            ticks: { color: colors.textColor },
                            grid: { color: colors.gridColor }
                        },
                        y: {
                            ticks: {
                                color: colors.textColor,
                                callback: function(value) { return '$' + (value / 1000000).toFixed(1) + 'M'; }
                            },
                            grid: { color: colors.gridColor }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: colors.textColor
                            }
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: $${(context.parsed.y / 1000000).toFixed(2)}M`;
                                }
                            }
                        }
                    },
                    animation: {
                        duration: 1000
                    }
                }
            });
        }

        // Initialize Client Portfolio Charts (for Client 360 view, not account specific)
        function initClientPortfolioCharts() {
            const colors = getChartColors();

            // Client Portfolio Performance Line Chart
            const ctxClientPortfolio = document.getElementById('clientPortfolioPerformanceChart').getContext('2d');
            clientPortfolioPerformanceChart = new Chart(ctxClientPortfolio, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    datasets: [{
                        label: 'Portfolio Value (USD)',
                        data: [5000000, 5100000, 5050000, 5200000, 5300000, 5350000],
                        borderColor: colors.lineColor,
                        backgroundColor: colors.lineFillColor,
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: colors.textColor },
                            grid: { color: colors.gridColor }
                        },
                        y: {
                            ticks: { color: colors.textColor, callback: function(value) { return '$' + value.toLocaleString(); } },
                            grid: { color: colors.gridColor }
                        }
                    },
                    animation: {
                        duration: 1000
                    }
                }
            });

            // Client Cash Flow Bar Chart
            const ctxClientCashFlow = document.getElementById('clientCashFlowChart').getContext('2d');
            clientCashFlowChart = new Chart(ctxClientCashFlow, {
                type: 'bar',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    datasets: [{
                        label: 'Net Cash Flow (USD)',
                        data: [10000, -5000, 15000, 2000, 8000, -3000],
                        backgroundColor: [
                            colors.cashFlowPositive, colors.cashFlowNegative, colors.cashFlowPositive,
                            colors.cashFlowPositive, colors.cashFlowPositive, colors.cashFlowNegative
                        ],
                        borderColor: [
                            colors.cashFlowBorderPositive, colors.cashFlowBorderNegative, colors.cashFlowBorderPositive,
                            colors.cashFlowBorderPositive, colors.cashFlowBorderPositive, colors.cashFlowBorderNegative
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: colors.textColor },
                            grid: { color: colors.gridColor }
                        },
                        y: {
                            ticks: { color: colors.textColor, callback: function(value) { return '$' + value.toLocaleString(); } },
                            grid: { color: colors.gridColor }
                        }
                    },
                    animation: {
                        duration: 1000
                    }
                }
            });
        }

        // --- New: Account Dashboard Charts ---
        function destroyAccountCharts() {
            if (accountPortfolioBreakdownChart) { accountPortfolioBreakdownChart.destroy(); accountPortfolioBreakdownChart = null; }
            if (accountPortfolioValueChangeChart) { accountPortfolioValueChangeChart.destroy(); accountPortfolioValueChangeChart = null; }
            if (accountAllocationComparisonChart) { accountAllocationComparisonChart.destroy(); accountAllocationComparisonChart = null; }
            if (accountAllocationMovementChart) { accountAllocationMovementChart.destroy(); accountAllocationMovementChart = null; }
            if (accountSectorAllocationChart) { accountSectorAllocationChart.destroy(); accountSectorAllocationChart = null; }
            if (accountHistoricalRiskChart) { accountHistoricalRiskChart.destroy(); accountHistoricalRiskChart = null; }
        }

        function initAccountPortfolioCharts(accountData) {
            const colors = getChartColors();

            // Portfolio Breakdown by Asset Class (Pie Chart)
            const ctxBreakdown = document.getElementById('accountPortfolioBreakdownChart').getContext('2d');
            accountPortfolioBreakdownChart = new Chart(ctxBreakdown, {
                type: 'pie',
                data: {
                    labels: accountData.portfolioBreakdown.labels,
                    datasets: [{
                        data: accountData.portfolioBreakdown.data,
                        backgroundColor: colors.pieColors,
                        borderColor: colors.isDarkMode ? '#2d3748' : '#ffffff',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                color: colors.textColor
                            }
                        },
                        title: { display: false }
                    },
                    animation: { animateRotate: true, animateScale: true }
                }
            });

            // Change in Portfolio Value over selectable durations (Line Chart)
            const ctxValueChange = document.getElementById('accountPortfolioValueChangeChart').getContext('2d');
            accountPortfolioValueChangeChart = new Chart(ctxValueChange, {
                type: 'line',
                data: {
                    labels: Array.from({length: accountData.portfolioValueChange['1M'].length}, (_, i) => `Day ${i+1}`), // Default to 1M
                    datasets: [{
                        label: 'Portfolio Value',
                        data: accountData.portfolioValueChange['1M'],
                        borderColor: colors.lineColor,
                        backgroundColor: colors.lineFillColor,
                        tension: 0.3,
                        fill: true,
                        pointRadius: 3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { ticks: { color: colors.textColor }, grid: { color: colors.gridColor } },
                        y: { ticks: { color: colors.textColor, callback: function(value) { return '$' + value.toLocaleString(); } }, grid: { color: colors.gridColor } }
                    },
                    animation: { duration: 1000 }
                }
            });

            // Event listeners for portfolio duration buttons
            document.querySelectorAll('.portfolio-duration-button').forEach(button => {
                button.addEventListener('click', function() {
                    document.querySelectorAll('.portfolio-duration-button').forEach(btn => {
                        btn.classList.remove('bg-blue-500', 'text-white', 'dark:bg-blue-600');
                        btn.classList.add('bg-gray-200', 'text-gray-700', 'dark:bg-gray-700', 'dark:text-gray-300');
                    });
                    this.classList.add('bg-blue-500', 'text-white', 'dark:bg-blue-600');
                    this.classList.remove('bg-gray-200', 'text-gray-700', 'dark:bg-gray-700', 'dark:text-gray-300');

                    const duration = this.dataset.duration;
                    const data = accountData.portfolioValueChange[duration];
                    let labels = [];
                    if (duration === '1M') labels = Array.from({length: data.length}, (_, i) => `Day ${i+1}`);
                    else if (duration === '3M') labels = ['Month 1', 'Month 2', 'Month 3', 'Month 4', 'Month 5', 'Month 6', 'Month 7', 'Month 8', 'Month 9', 'Month 10', 'Month 11', 'Month 12'].slice(0, data.length);
                    else labels = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'].slice(0, data.length);


                    accountPortfolioValueChangeChart.data.labels = labels;
                    accountPortfolioValueChangeChart.data.datasets[0].data = data;
                    accountPortfolioValueChangeChart.update();
                });
            });


            // Current Allocation vs Strategic Allocation (Bar + Line Combo)
            const ctxAllocationComparison = document.getElementById('accountAllocationComparisonChart').getContext('2d');
            accountAllocationComparisonChart = new Chart(ctxAllocationComparison, {
                type: 'bar',
                data: {
                    labels: ['Equities', 'Fixed Income', 'Commodities', 'Cash'],
                    datasets: [
                        {
                            label: 'Current Allocation (%)',
                            data: accountData.currentAllocation,
                            backgroundColor: colors.barColors[0], // Green
                            borderColor: colors.barColors[0],
                            borderWidth: 1
                        },
                        {
                            label: 'Strategic Allocation (%)',
                            data: accountData.strategicAllocation,
                            type: 'line',
                            borderColor: colors.lineColor,
                            backgroundColor: 'transparent',
                            pointBackgroundColor: colors.lineColor,
                            pointBorderColor: colors.lineColor,
                            pointRadius: 5,
                            fill: false,
                            tension: 0.1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: colors.textColor }
                        }
                    },
                    scales: {
                        x: { ticks: { color: colors.textColor }, grid: { color: colors.gridColor } },
                        y: { beginAtZero: true, ticks: { color: colors.textColor, callback: function(value) { return value + '%'; } }, grid: { color: colors.gridColor } }
                    },
                    animation: { duration: 1000 }
                }
            });

            // Allocation Movement over time (Line Chart)
            const ctxAllocationMovement = document.getElementById('accountAllocationMovementChart').getContext('2d');
            accountAllocationMovementChart = new Chart(ctxAllocationMovement, {
                type: 'line',
                data: {
                    labels: accountData.allocationMovement.labels,
                    datasets: [
                        {
                            label: 'Equity Allocation (%)',
                            data: accountData.allocationMovement.equity,
                            borderColor: colors.barColors[0],
                            backgroundColor: 'transparent',
                            tension: 0.3,
                            pointRadius: 3
                        },
                        {
                            label: 'Fixed Income Allocation (%)',
                            data: accountData.allocationMovement.fixedIncome,
                            borderColor: colors.barColors[1],
                            backgroundColor: 'transparent',
                            tension: 0.3,
                            pointRadius: 3
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: colors.textColor }
                        }
                    },
                    scales: {
                        x: { ticks: { color: colors.textColor }, grid: { color: colors.gridColor } },
                        y: { beginAtZero: true, ticks: { color: colors.textColor, callback: function(value) { return value + '%'; } }, grid: { color: colors.gridColor } }
                    },
                    animation: { duration: 1000 }
                }
            });

            // Sector Allocation (Stacked Bar)
            const ctxSectorAllocation = document.getElementById('accountSectorAllocationChart').getContext('2d');
            accountSectorAllocationChart = new Chart(ctxSectorAllocation, {
                type: 'bar',
                data: {
                    labels: accountData.sectorAllocation.labels,
                    datasets: [{
                        label: 'Allocation (%)',
                        data: accountData.sectorAllocation.data,
                        backgroundColor: colors.pieColors, // Reusing pie colors for diverse bars
                        borderColor: colors.isDarkMode ? '#2d3748' : '#ffffff',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { ticks: { color: colors.textColor }, grid: { color: colors.gridColor } },
                        y: { beginAtZero: true, ticks: { color: colors.textColor, callback: function(value) { return value + '%'; } }, grid: { color: colors.gridColor } }
                    },
                    animation: { duration: 1000 }
                }
            });
        }

        function populateHoldingsTables(topHoldings, bottomHoldings) {
            const topHoldingsBody = document.getElementById('top-holdings-table-body');
            const bottomHoldingsBody = document.getElementById('bottom-holdings-table-body');

            topHoldingsBody.innerHTML = '';
            bottomHoldingsBody.innerHTML = '';

            topHoldings.forEach(holding => {
                const row = `
                    <tr>
                        <td class="px-4 py-3 whitespace-nowrap text-gray-700 dark:text-gray-300">${holding.name}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-gray-700 dark:text-gray-300">${holding.weight.toFixed(1)}%</td>
                        <td class="px-4 py-3 whitespace-nowrap ${holding.return >= 0 ? 'text-green-600' : 'text-red-600'}">${holding.return >= 0 ? '+' : ''}${holding.return.toFixed(1)}%</td>
                        <td class="px-4 py-3 whitespace-nowrap text-gray-700 dark:text-gray-300">${holding.currency}</td>
                    </tr>
                `;
                topHoldingsBody.insertAdjacentHTML('beforeend', row);
            });

            bottomHoldings.forEach(holding => {
                const row = `
                    <tr>
                        <td class="px-4 py-3 whitespace-nowrap text-gray-700 dark:text-gray-300">${holding.name}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-gray-700 dark:text-gray-300">${holding.weight.toFixed(1)}%</td>
                        <td class="px-4 py-3 whitespace-nowrap ${holding.return >= 0 ? 'text-green-600' : 'text-red-600'}">${holding.return >= 0 ? '+' : ''}${holding.return.toFixed(1)}%</td>
                        <td class="px-4 py-3 whitespace-nowrap text-gray-700 dark:text-gray-300">${holding.currency}</td>
                    </tr>
                `;
                bottomHoldingsBody.insertAdjacentHTML('beforeend', row);
            });
        }

        function populateAccountSummary(accountData) {
            document.getElementById('summary-creation-date').textContent = accountData.summary.creationDate;
            document.getElementById('summary-mandate-type').textContent = accountData.summary.mandateType;
            document.getElementById('summary-custodian').textContent = accountData.summary.custodianName;
            document.getElementById('summary-compliance-status').textContent = accountData.summary.complianceStatus;
            document.getElementById('summary-compliance-status').className = `font-semibold ${accountData.summary.complianceStatus.includes('Compliant') ? 'text-green-600' : 'text-red-600'}`;
            document.getElementById('summary-investment-guidelines').textContent = accountData.summary.investmentGuidelines;
            document.getElementById('summary-currency').textContent = accountData.summary.currencyUsed;
        }

        function updateRiskGauge(score) {
            const colors = getChartColors();
            const arc = document.getElementById('risk-gauge-value-arc');
            const needle = document.getElementById('risk-gauge-needle');
            const label = document.getElementById('risk-gauge-label');

            // Calculate rotation for needle (0-100 score maps to 0-180 degrees)
            const rotation = (score / 100) * 180 - 90; // -90 to start from left, 90 to end at right
            needle.style.transform = `translateX(-50%) rotate(${rotation}deg)`;

            // Determine color based on score
            let color;
            if (score < 40) {
                color = colors.riskLow;
            } else if (score < 75) {
                color = colors.riskMedium;
            } else {
                color = colors.riskHigh;
            }

            // Update arc and needle color
            arc.style.borderColor = `${color} transparent transparent transparent`;
            needle.style.backgroundColor = color;
            document.querySelector('.gauge-chart-center-dot').style.backgroundColor = color;

            label.textContent = `Score: ${score}`;
            label.style.color = colors.textColor; // Ensure label text color adapts
        }

        function updateRiskGaugeColor(score) {
            const colors = getChartColors();
            const arc = document.getElementById('risk-gauge-value-arc');
            const needle = document.getElementById('risk-gauge-needle');
            const centerDot = document.querySelector('.gauge-chart-center-dot');
            const label = document.getElementById('risk-gauge-label');

            let color;
            if (score < 40) {
                color = colors.riskLow;
            } else if (score < 75) {
                color = colors.riskMedium;
            } else {
                color = colors.riskHigh;
            }

            arc.style.borderColor = `${color} transparent transparent transparent`;
            needle.style.backgroundColor = color;
            centerDot.style.backgroundColor = color;
            label.style.color = colors.textColor; // Ensure label text color adapts
            document.getElementById('risk-gauge-arc').style.borderColor = colors.isDarkMode ? '#4a5568' : '#e2e8f0'; // Base arc color
        }


        function initAccountRiskCharts(accountData) {
            const colors = getChartColors();

            // Current Risk Score Gauge Chart
            updateRiskGauge(accountData.riskScore);
            updateRiskGaugeColor(accountData.riskScore); // Initial color update

            // Historical Risk Score Trend (Line chart)
            const ctxHistoricalRisk = document.getElementById('accountHistoricalRiskChart').getContext('2d');
            accountHistoricalRiskChart = new Chart(ctxHistoricalRisk, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'], // Mock labels
                    datasets: [{
                        label: 'Risk Score',
                        data: accountData.historicalRiskScore,
                        borderColor: colors.lineColor,
                        backgroundColor: colors.lineFillColor,
                        tension: 0.3,
                        fill: false,
                        pointRadius: 3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { ticks: { color: colors.textColor }, grid: { color: colors.gridColor } },
                        y: { beginAtZero: true, max: 100, ticks: { color: colors.textColor }, grid: { color: colors.gridColor } }
                    },
                    animation: { duration: 1000 }
                }
            });
        }

        function populateRiskAlerts(accountData) {
            const alertsList = document.getElementById('risk-alerts-list');
            alertsList.innerHTML = '';
            if (accountData.alerts && accountData.alerts.length > 0) {
                accountData.alerts.forEach(alert => {
                    let textColorClass = 'text-gray-700 dark:text-gray-300';
                    if (alert.severity === 'High') textColorClass = 'text-red-600 dark:text-red-400';
                    else if (alert.severity === 'Medium') textColorClass = 'text-yellow-600 dark:text-yellow-400';

                    const listItem = `
                        <li class="bg-gray-50 dark:bg-gray-800 p-3 rounded-lg flex items-center">
                            <i class="fas fa-exclamation-circle mr-2 ${textColorClass}"></i>
                            <span class="${textColorClass} font-medium">${alert.type}:</span>
                            <span class="ml-2 text-gray-600 dark:text-gray-400">${alert.description}</span>
                        </li>
                    `;
                    alertsList.insertAdjacentHTML('beforeend', listItem);
                });
            } else {
                alertsList.innerHTML = '<li class="text-gray-600 dark:text-gray-400">No active alerts for this account.</li>';
            }
        }

        function populateCashLiquidity(accountData) {
            document.getElementById('cash-available').textContent = `$${accountData.cashLiquidity.availableCash.toLocaleString()}`;
            document.getElementById('cash-inflows').textContent = accountData.cashLiquidity.pendingInflows;
            document.getElementById('cash-outflows').textContent = accountData.cashLiquidity.pendingOutflows;
            document.getElementById('cash-recommended').textContent = `$${accountData.cashLiquidity.recommendedCashBuffer.toLocaleString()}`;
            document.getElementById('cash-redemptions').textContent = accountData.cashLiquidity.upcomingRedemptions;
        }

        function populateRecentTransactions(accountData) {
            const transactionsTableBody = document.getElementById('transactions-table-body');
            transactionsTableBody.innerHTML = '';
            accountData.transactions.forEach(transaction => {
                const statusColorClass = transaction.status === 'Completed' ? 'text-green-600' : 'text-yellow-600';
                const row = `
                    <tr>
                        <td class="px-4 py-3 whitespace-nowrap text-gray-700 dark:text-gray-300">${transaction.date}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-gray-700 dark:text-gray-300">${transaction.security}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-gray-700 dark:text-gray-300">${transaction.type}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-gray-700 dark:text-gray-300">${transaction.quantity}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-gray-700 dark:text-gray-300">$${transaction.value.toLocaleString()}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-gray-700 dark:text-gray-300">${transaction.currency}</td>
                        <td class="px-4 py-3 whitespace-nowrap ${statusColorClass}">${transaction.status}</td>
                    </tr>
                `;
                transactionsTableBody.insertAdjacentHTML('beforeend', row);
            });
        }

        function populateAccountDocuments(accountData) {
            const documentsList = document.getElementById('account-documents-list');
            documentsList.innerHTML = '';
            if (accountData.documents && accountData.documents.length > 0) {
                accountData.documents.forEach(doc => {
                    let iconClass = 'fas fa-file';
                    let iconColorClass = 'text-gray-500';
                    if (doc.name.endsWith('.pdf')) { iconClass = 'fas fa-file-pdf'; iconColorClass = 'text-red-500'; }
                    else if (doc.name.endsWith('.xlsx')) { iconClass = 'fas fa-file-excel'; iconColorClass = 'text-green-600'; }
                    else if (doc.name.endsWith('.docx')) { iconClass = 'fas fa-file-word'; iconColorClass = 'text-blue-500'; }

                    const listItem = `
                        <li class="bg-gray-50 dark:bg-gray-800 p-3 rounded-lg flex items-center justify-between text-gray-900 dark:text-gray-200 text-sm">
                            <span><i class="${iconClass} mr-2 ${iconColorClass}"></i>${doc.name}</span>
                            <span class="text-xs text-gray-500 dark:text-gray-400">Uploaded: ${doc.date}</span>
                            <a href="#" class="text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-500 text-xs ml-auto">${doc.action}</a>
                        </li>
                    `;
                    documentsList.insertAdjacentHTML('beforeend', listItem);
                });
            } else {
                documentsList.innerHTML = '<li class="text-gray-600 dark:text-gray-400">No documents available for this account.</li>';
            }
        }


        // Upcoming Activities/Events Toggle Logic
        const activitiesToggle = document.getElementById('activities-toggle');
        const eventsToggle = document.getElementById('events-toggle');
        const activitiesContent = document.getElementById('activities-content');
        const eventsContent = document.getElementById('events-content');

        function toggleScheduleView(view) {
            if (view === 'activities') {
                activitiesContent.classList.remove('hidden');
                eventsContent.classList.add('hidden');
                activitiesToggle.classList.add('bg-blue-500', 'text-white', 'dark:bg-blue-600', 'dark:text-gray-100');
                activitiesToggle.classList.remove('bg-gray-200', 'text-gray-700', 'dark:bg-gray-700', 'dark:text-gray-300', 'hover:bg-gray-300', 'dark:hover:bg-gray-500');
                eventsToggle.classList.remove('bg-blue-500', 'text-white', 'dark:bg-blue-600', 'dark:text-gray-100');
                eventsToggle.classList.add('bg-gray-200', 'text-gray-700', 'dark:bg-gray-700', 'dark:text-gray-300', 'hover:bg-gray-300', 'dark:hover:bg-gray-500');
            } else if (view === 'events') {
                activitiesContent.classList.add('hidden');
                eventsContent.classList.remove('hidden');
                eventsToggle.classList.add('bg-blue-500', 'text-white', 'dark:bg-blue-600', 'dark:text-gray-100');
                eventsToggle.classList.remove('bg-gray-200', 'text-gray-700', 'dark:bg-gray-700', 'dark:text-gray-300', 'hover:bg-gray-300', 'dark:hover:bg-gray-500');
                activitiesToggle.classList.remove('bg-blue-500', 'text-white', 'dark:bg-blue-600', 'dark:text-gray-100');
                activitiesToggle.classList.add('bg-gray-200', 'text-gray-700', 'dark:bg-gray-700', 'dark:text-gray-300', 'hover:bg-gray-300', 'dark:hover:bg-gray-500');
            }
        }

        activitiesToggle.addEventListener('click', () => toggleScheduleView('activities'));
        eventsToggle.addEventListener('click', () => toggleScheduleView('events'));

        // --- Products View Logic ---
        let cartCount = 0;
        const cartCountSpan = document.getElementById('cart-count');
        const productCardsGrid = document.getElementById('product-cards-grid');
        const filterButtons = document.querySelectorAll('.filter-button');
        const sortByDropdown = document.getElementById('sort-by');
        const filterCurrencyDropdown = document.getElementById('filter-currency');
        const shariahToggleContainer = document.querySelector('.toggle-shariah');
        const shariahToggle = document.getElementById('shariah-toggle');
        const productsPerformanceToggle = document.getElementById('products-performance-toggle');
        const productsRiskToggle = document.getElementById('products-risk-toggle');
        const productsFlowsToggle = document.getElementById('products-flows-toggle');
        const productsInsightsContent = document.getElementById('products-insights-content');
        const performanceHeatmapContent = document.getElementById('performance-heatmap-content');
        const riskContent = document.getElementById('risk-content');
        const flowsContent = document.getElementById('flows-content');

        // Dummy Product Data
        const products = [
            // Equities
            { name: "Al Rajhi Equity Fund", category: "Equities", structure: "Shariah-Compliant Stocks", return: 12.6, currency: "SAR", isShariah: true, description: "Diversified exposure to top halal stocks listed on Tadawul.", historicalReturns: [10, 11, 12, 11.5, 12.6, 13] },
            { name: "Dubai Islamic Equities", category: "Equities", structure: "Shariah-Compliant Stocks", return: 10.1, currency: "AED", isShariah: true, description: "Invests in Shari'ah-compliant companies on DFM and ADX.", historicalReturns: [8, 9, 10, 9.5, 10.1, 11] },
            { name: "Kuwait Halal Growth", category: "Equities", structure: "Shariah-Compliant Stocks", return: 11.8, currency: "KWD", isShariah: true, description: "Focuses on high-growth halal equities in Kuwait.", historicalReturns: [9, 10, 11, 10.5, 11.8, 12] },
            { name: "Qatar Shariah Leaders", category: "Equities", structure: "Shariah-Compliant Stocks", return: 9.5, currency: "QAR", isShariah: true, description: "Tracks leading Shari'ah-compliant companies in Qatar.", historicalReturns: [7, 8, 9, 8.5, 9.5, 10] },
            { name: "Egyptian Islamic Index", category: "Equities", structure: "Shariah-Compliant Stocks", return: 8.7, currency: "EGP", isShariah: true, description: "Exposure to Shari'ah-screened Egyptian equities.", historicalReturns: [6, 7, 8, 7.5, 8.7, 9] },
            { name: "Global Islamic Tech", category: "Equities", structure: "Shariah-Compliant Stocks", return: 15.2, currency: "USD", isShariah: true, description: "Invests globally in Shari'ah-compliant technology companies.", historicalReturns: [12, 13, 14, 13.5, 15.2, 16] },

            // Sukuk
            { name: "Emirates Ijarah Sukuk", category: "Sukuk", structure: "Ijarah-based Sukuk", return: 4.2, currency: "AED", isShariah: true, description: "Asset-backed sukuk issued by UAE government-linked entities.", historicalReturns: [3.5, 3.8, 4.0, 4.1, 4.2, 4.3] },
            { name: "Saudi Sovereign Sukuk", category: "Sukuk", structure: "Murabaha-based Sukuk", return: 3.8, currency: "SAR", isShariah: true, description: "Government-issued sukuk for stable, Shari'ah-compliant income.", historicalReturns: [3.0, 3.2, 3.5, 3.7, 3.8, 3.9] },
            { name: "Bahrain Corporate Sukuk", category: "Sukuk", structure: "Mudarabah-based Sukuk", return: 5.1, currency: "BHD", isShariah: true, description: "Invests in corporate sukuk from Bahraini entities.", historicalReturns: [4.5, 4.8, 5.0, 5.0, 5.1, 5.2] },
            { name: "Malaysia Global Sukuk", category: "Sukuk", structure: "Hybrid Sukuk", return: 4.5, currency: "USD", isShariah: true, description: "International sukuk exposure from Malaysian issuers.", historicalReturns: [4.0, 4.2, 4.3, 4.4, 4.5, 4.6] },
            { name: "Oman Development Sukuk", category: "Sukuk", structure: "Istisna'a-based Sukuk", return: 4.0, currency: "OMR", isShariah: true, description: "Supports infrastructure projects with Shari'ah compliance.", historicalReturns: [3.5, 3.7, 3.8, 3.9, 4.0, 4.1] },
            { name: "Turkey Sukuk Fund", category: "Sukuk", structure: "Wakala-based Sukuk", return: 6.0, currency: "TRY", isShariah: true, description: "Actively managed fund investing in Turkish sukuk.", historicalReturns: [5.0, 5.5, 5.8, 5.9, 6.0, 6.1] },

            // Mutual Funds & ETFs
            { name: "KFH Islamic Balanced Fund", category: "Mutual Funds & ETFs", structure: "Mixed (Equity + Sukuk)", return: 7.8, currency: "KWD", isShariah: true, description: "Combines income and growth with Shariah oversight board.", historicalReturns: [6.5, 7.0, 7.5, 7.7, 7.8, 8.0] },
            { name: "Al-Ahli GCC Growth Fund", category: "Mutual Funds & ETFs", structure: "Equity Mutual Fund", return: 9.1, currency: "SAR", isShariah: true, description: "Invests in growth-oriented GCC Shari'ah-compliant companies.", historicalReturns: [8.0, 8.5, 8.9, 9.0, 9.1, 9.3] },
            { name: "Global Sukuk Income Fund", category: "Mutual Funds & ETFs", structure: "Sukuk Mutual Fund", return: 3.5, currency: "USD", isShariah: true, description: "Seeks stable income from global sukuk markets.", historicalReturns: [3.0, 3.2, 3.3, 3.4, 3.5, 3.6] },
            { name: "ADCB Shari'ah Dividend ETF", category: "Mutual Funds & ETFs", structure: "Equity ETF", return: 8.5, currency: "AED", isShariah: true, description: "Tracks high-dividend Shari'ah-compliant stocks in UAE.", historicalReturns: [7.5, 8.0, 8.2, 8.4, 8.5, 8.7] },
            { name: "Non-Shari'ah Global Tech Fund", category: "Mutual Funds & ETFs", structure: "Equity Mutual Fund", return: 18.0, currency: "USD", isShariah: false, description: "Invests in global technology companies (not Shari'ah compliant).", historicalReturns: [15, 16, 17, 17.5, 18.0, 18.5] },
            { name: "European Growth Equity (Non-Shari'ah)", category: "Mutual Funds & ETFs", structure: "Equity Mutual Fund", return: 10.5, currency: "EUR", isShariah: false, description: "Focuses on European growth equities (not Shari'ah compliant).", historicalReturns: [9.5, 10.0, 10.2, 10.4, 10.5, 10.8] },
            { name: "US Large Cap ETF (Non-Shari'ah)", category: "Mutual Funds & ETFs", structure: "Equity ETF", return: 14.0, currency: "USD", isShariah: false, description: "Tracks major US large-cap companies (not Shari'ah compliant).", historicalReturns: [12, 13, 13.5, 13.8, 14.0, 14.2] },

            // Real Estate/REITs
            { name: "Jadwa REIT Saudi", category: "Real Estate/REITs", structure: "Income-generating REIT", return: 5.3, currency: "SAR", isShariah: true, description: "Invests in halal commercial properties across KSA.", historicalReturns: [4.5, 4.8, 5.0, 5.1, 5.3, 5.4] },
            { name: "Al Safwa Properties Fund", category: "Real Estate/REITs", structure: "Direct Real Estate Investment", return: 6.5, currency: "AED", isShariah: true, description: "Direct investments in Shari'ah-compliant real estate projects in Dubai.", historicalReturns: [5.8, 6.0, 6.2, 6.3, 6.5, 6.7] },
            { name: "Bahrain REIT Income", category: "Real Estate/REITs", structure: "Income-generating REIT", return: 5.8, currency: "BHD", isShariah: true, description: "Provides consistent income from Bahraini real estate assets.", historicalReturns: [5.0, 5.3, 5.5, 5.7, 5.8, 6.0] },
            { name: "UK Islamic Property Fund", category: "Real Estate/REITs", structure: "Indirect Property Investment", return: 7.1, currency: "GBP", isShariah: true, description: "Invests in Shari'ah-compliant commercial properties in the UK.", historicalReturns: [6.5, 6.8, 7.0, 7.0, 7.1, 7.3] },
            { name: "Qatar Real Estate Growth", category: "Real Estate/REITs", structure: "Development Fund", return: 8.0, currency: "QAR", isShariah: true, description: "Participates in Shari'ah-compliant property development projects.", historicalReturns: [7.0, 7.5, 7.8, 7.9, 8.0, 8.2] },
            { name: "Global Hospitality REIT", category: "Real Estate/REITs", structure: "Hospitality REIT", return: 4.9, currency: "USD", isShariah: true, description: "Invests in Shari'ah-compliant hotels and resorts globally.", historicalReturns: [4.0, 4.3, 4.5, 4.7, 4.9, 5.0] },

            // Commodities
            { name: "GCC Murabaha Commodity Fund", category: "Commodities", structure: "Murabaha-based", return: 3.1, currency: "AED", isShariah: true, description: "Short-term commodity trades based on Islamic finance.", historicalReturns: [2.5, 2.8, 3.0, 3.0, 3.1, 3.2] },
            { name: "Gold Salam Fund", category: "Commodities", structure: "Salam-based", return: 7.5, currency: "USD", isShariah: true, description: "Provides Shari'ah-compliant exposure to physical gold.", historicalReturns: [6.5, 7.0, 7.2, 7.4, 7.5, 7.6] },
            { name: "Silver Murabaha Trust", category: "Commodities", structure: "Murabaha-based", return: 6.2, currency: "USD", isShariah: true, description: "Invests in silver through a Shari'ah-compliant structure.", historicalReturns: [5.5, 5.8, 6.0, 6.1, 6.2, 6.3] },
            { name: "Palm Oil Istisna'a Fund", category: "Commodities", structure: "Istisna'a-based", return: 5.0, currency: "MYR", isShariah: true, description: "Invests in palm oil production via Islamic contract.", historicalReturns: [4.5, 4.7, 4.8, 4.9, 5.0, 5.1] },
            { name: "Energy Sukuk Portfolio", category: "Commodities", structure: "Sukuk-linked Commodities", return: 4.8, currency: "SAR", isShariah: true, description: "Exposure to energy sector commodities via Shari'ah bonds.", historicalReturns: [4.0, 4.2, 4.5, 4.7, 4.8, 4.9] },
            { name: "Global Halal Food Fund", category: "Commodities", structure: "Murabaha-based", return: 8.1, currency: "USD", isShariah: true, description: "Focuses on commodities used in halal food production.", historicalReturns: [7.0, 7.5, 7.8, 8.0, 8.1, 8.3] },

            // Private Equity / VC
            { name: "MEA Halal Growth Fund", category: "Private Equity/VC", structure: "Mudarabah Partnership", return: 9.4, currency: "USD", isShariah: true, description: "Invests in early-stage Shariah-compliant tech firms.", historicalReturns: [8.0, 8.5, 9.0, 9.2, 9.4, 9.6] },
            { name: "Saudi SME Equity Fund", category: "Private Equity/VC", structure: "Musharakah Partnership", return: 11.5, currency: "SAR", isShariah: true, description: "Supports Shari'ah-compliant small and medium enterprises in KSA.", historicalReturns: [10.0, 10.5, 11.0, 11.2, 11.5, 11.8] },
            { name: "UAE Venture Capital Islamic", category: "Private Equity/VC", structure: "Wakala Investment", return: 13.0, currency: "AED", isShariah: true, description: "Provides venture capital to emerging Shari'ah-compliant startups.", historicalReturns: [11.5, 12.0, 12.5, 12.8, 13.0, 13.2] },
            { name: "African Fintech Fund (Halal)", category: "Private Equity/VC", structure: "Mudarabah Partnership", return: 10.8, currency: "USD", isShariah: true, description: "Invests in Shari'ah-compliant fintech innovations across Africa.", historicalReturns: [9.5, 10.0, 10.3, 10.6, 10.8, 11.0] },
            { name: "Global Blockchain Islamic PE", category: "Private Equity/VC", structure: "Musharakah Partnership", return: 14.5, currency: "USD", isShariah: true, description: "Invests in Shari'ah-compliant blockchain technology companies.", historicalReturns: [13.0, 13.5, 14.0, 14.2, 14.5, 14.8] },
            { name: "GCC Healthcare Private Equity", category: "Private Equity/VC", structure: "Ijarah Partnership", return: 9.9, currency: "AED", isShariah: true, description: "Focuses on Shari'ah-compliant healthcare businesses in the GCC.", historicalReturns: [8.5, 9.0, 9.5, 9.7, 9.9, 10.1] }
        ];

        // Function to render sparklines within product cards
        function renderSparkline(canvasId, data) {
            const colors = getChartColors();
            const ctx = document.getElementById(canvasId)?.getContext('2d');
            if (ctx) {
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: Array.from({length: data.length}, (_, i) => i + 1), // Simple labels for sparkline
                        datasets: [{
                            data: data,
                            borderColor: colors.shariahLineColor, // Consistent color
                            borderWidth: 1.5,
                            fill: false,
                            tension: 0.3,
                            pointRadius: 0 // No points
                        }]
                    },
                    options: {
                        responsive: false, // Keep static for sparklines
                        maintainAspectRatio: false,
                        elements: {
                            line: {
                                borderWidth: 1
                            }
                        },
                        scales: {
                            x: { display: false },
                            y: { display: false }
                        },
                        plugins: {
                            legend: { display: false },
                            tooltip: { enabled: false }
                        },
                        layout: {
                            padding: {
                                left: 0,
                                right: 0,
                                top: 0,
                                bottom: 0
                            }
                        }
                    }
                });
            }
        }

        function renderProducts() {
            productCardsGrid.innerHTML = ''; // Clear existing cards
            let filteredProducts = [...products]; // Create a mutable copy

            // Apply category filter
            const selectedCategory = document.querySelector('.filter-button.active')?.dataset.category || 'All';
            if (selectedCategory !== 'All') {
                filteredProducts = filteredProducts.filter(p => p.category === selectedCategory);
            }

            // Show/hide Shariah toggle based on category
            if (selectedCategory === "Mutual Funds & ETFs") {
                shariahToggleContainer.classList.remove('hidden');
            } else {
                shariahToggleContainer.classList.add('hidden');
            }

            // Apply Shariah filter (only for Mutual Funds & ETFs)
            if (selectedCategory === "Mutual Funds & ETFs") {
                if (shariahToggle.checked) {
                    filteredProducts = filteredProducts.filter(p => p.isShariah === true);
                } else {
                     filteredProducts = filteredProducts.filter(p => p.isShariah === false);
                }
            }


            // Apply Currency filter
            const selectedCurrency = filterCurrencyDropdown.value;
            if (selectedCurrency !== 'All') {
                filteredProducts = filteredProducts.filter(p => p.currency === selectedCurrency);
            }

            // Apply Sorting
            const sortBy = sortByDropdown.value;
            if (sortBy === 'return-asc') {
                filteredProducts.sort((a, b) => a.return - b.return);
            } else if (sortBy === 'return-desc') {
                filteredProducts.sort((a, b) => b.return - a.return);
            }

            filteredProducts.forEach((product, index) => {
                const card = document.createElement('div');
                card.className = 'bg-white dark:bg-gray-700 p-4 rounded-lg shadow-md border border-gray-200 dark:border-gray-600 relative product-card';
                card.innerHTML = `
                    <div class="absolute top-4 right-4 flex items-center space-x-2">
                        <i class="fas fa-plus text-lg product-action-icon add-to-cart-icon" data-product='${JSON.stringify(product)}'></i>
                        <a href="https://ujjwalpatilcred.github.io/Fund_Factsheet_sample/Fund%20Factsheet%20Sample%201.html" target="_blank" class="product-action-icon">
                            <i class="fas fa-download text-lg"></i>
                        </a>
                    </div>
                    <div class="content-area">
                        <h4 class="text-lg font-semibold text-blue-600 dark:text-blue-400 mb-1">${product.name}</h4>
                        <p class="text-sm text-gray-600 dark:text-gray-400 mb-0.5"><strong>Asset Class:</strong> ${product.category}</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400 mb-0.5"><strong>Structure:</strong> ${product.structure}</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400 mb-0.5"><strong>Currency:</strong> ${product.currency}</p>
                        <div class="flex items-center text-sm text-green-600 mb-2">
                            <span><strong>1-Year Return:</strong> +${product.return}%</span>
                            <canvas id="sparkline-${index}" width="60" height="20" class="ml-2"></canvas>
                        </div>
                        <p class="text-xs text-gray-700 dark:text-gray-300 leading-tight">${product.description}</p>
                    </div>
                `;
                productCardsGrid.appendChild(card);
            });

            // After cards are rendered, initialize sparklines
            filteredProducts.forEach((product, index) => {
                renderSparkline(`sparkline-${index}`, product.historicalReturns);
            });

            // Add event listeners for new cart buttons
            document.querySelectorAll('.add-to-cart-icon').forEach(icon => {
                icon.addEventListener('click', function() {
                    cartCount++;
                    cartCountSpan.textContent = cartCount;
                    console.log('Product added to cart:', JSON.parse(this.dataset.product).name);
                });
            });
        }

        // Toggle logic for products insights (Performance, Risk, Flows)
        function toggleProductsInsightsView(view) {
            productsPerformanceToggle.classList.remove('bg-blue-500', 'text-white', 'dark:bg-blue-600');
            productsPerformanceToggle.classList.add('bg-gray-200', 'text-gray-700', 'dark:bg-gray-700', 'dark:text-gray-300', 'hover:bg-gray-300', 'dark:hover:bg-gray-600');
            
            productsRiskToggle.classList.remove('bg-blue-500', 'text-white', 'dark:bg-blue-600');
            productsRiskToggle.classList.add('bg-gray-200', 'text-gray-700', 'dark:bg-gray-700', 'dark:text-gray-300', 'hover:bg-gray-300', 'dark:hover:bg-gray-600');
            
            productsFlowsToggle.classList.remove('bg-blue-500', 'text-white', 'dark:bg-blue-600');
            productsFlowsToggle.classList.add('bg-gray-200', 'text-gray-700', 'dark:bg-gray-700', 'dark:text-gray-300', 'hover:bg-gray-300', 'dark:hover:bg-gray-600');

            performanceHeatmapContent.classList.add('hidden');
            riskContent.classList.add('hidden');
            flowsContent.classList.add('hidden');

            if (view === 'performance') {
                productsPerformanceToggle.classList.add('bg-blue-500', 'text-white', 'dark:bg-blue-600');
                productsPerformanceToggle.classList.remove('bg-gray-200', 'text-gray-700', 'dark:bg-gray-700', 'dark:text-gray-300', 'hover:bg-gray-300', 'dark:hover:bg-gray-600');
                performanceHeatmapContent.classList.remove('hidden');
            } else if (view === 'risk') {
                productsRiskToggle.classList.add('bg-blue-500', 'text-white', 'dark:bg-blue-600');
                productsRiskToggle.classList.remove('bg-gray-200', 'text-gray-700', 'dark:bg-gray-700', 'dark:text-gray-300', 'hover:bg-gray-300', 'dark:hover:bg-gray-600');
                riskContent.classList.remove('hidden');
            } else if (view === 'flows') {
                productsFlowsToggle.classList.add('bg-blue-500', 'text-white', 'dark:bg-blue-600');
                productsFlowsToggle.classList.remove('bg-gray-200', 'text-gray-700', 'dark:bg-gray-700', 'dark:text-gray-300', 'hover:bg-gray-300', 'dark:hover:bg-gray-600');
                flowsContent.classList.remove('hidden');
            }
        }

        productsPerformanceToggle.addEventListener('click', () => toggleProductsInsightsView('performance'));
        productsRiskToggle.addEventListener('click', () => toggleProductsInsightsView('risk'));
        productsFlowsToggle.addEventListener('click', () => toggleProductsInsightsView('flows'));


        // Event listeners for filter buttons
        filterButtons.forEach(button => {
            button.addEventListener('click', function() {
                filterButtons.forEach(btn => btn.classList.remove('active', 'bg-blue-500', 'text-white', 'dark:bg-blue-600', 'dark:text-gray-100'));
                filterButtons.forEach(btn => btn.classList.add('bg-gray-200', 'text-gray-700', 'dark:bg-gray-700', 'dark:text-gray-300', 'hover:bg-gray-300', 'dark:hover:bg-gray-500'));
                
                this.classList.add('active', 'bg-blue-500', 'text-white', 'dark:bg-blue-600', 'dark:text-gray-100');
                this.classList.remove('bg-gray-200', 'text-gray-700', 'dark:bg-gray-700', 'dark:text-gray-300', 'hover:bg-gray-300', 'dark:hover:bg-gray-500');
                
                renderProducts();
            });
        });

        // Event listener for sort dropdown
        sortByDropdown.addEventListener('change', renderProducts);
        filterCurrencyDropdown.addEventListener('change', renderProducts);
        shariahToggle.addEventListener('change', renderProducts);

        // Initialize dashboard view on load
        document.addEventListener('DOMContentLoaded', () => {
            const dashboardLink = document.querySelector('.nav-link[data-target="dashboard-view"]');
            if (dashboardLink) {
                dashboardLink.click(); // This will trigger the nav-link click handler, which initializes dashboard charts
            }
            toggleScheduleView('activities'); // Set default toggle view for dashboard
            
            // Ensure products view starts with Performance toggle active if it's the initial view
            if (!document.getElementById('products-view').classList.contains('hidden')) {
                toggleProductsInsightsView('performance');
            }
            renderClientsList(); // Initial render of clients list
        });

        // Clients Attention Modal Logic
        const clientsAttentionCard = document.getElementById('clients-attention-card');
        const clientsAttentionModal = document.getElementById('clients-attention-modal');
        const closeAttentionModalBtn = document.getElementById('close-attention-modal');

        clientsAttentionCard.addEventListener('click', () => {
            clientsAttentionModal.classList.remove('hidden');
        });

        closeAttentionModalBtn.addEventListener('click', () => {
            clientsAttentionModal.classList.add('hidden');
        });

        // Close modal if clicked outside (optional, but good UX)
        clientsAttentionModal.addEventListener('click', (e) => {
            if (e.target === clientsAttentionModal) {
                clientsAttentionModal.classList.add('hidden');
            }
        });

        // Notification Panel Logic
        const notificationBell = document.getElementById('notification-bell');
        const notificationBadge = document.getElementById('notification-badge');
        const notificationPanel = document.getElementById('notification-panel');
        const closeNotificationPanelBtn = document.getElementById('close-notification-panel');

        // Initial state of notification badge
        notificationBadge.style.display = 'block'; // Or 'none' if no notifications initially

        notificationBell.addEventListener('click', (e) => {
            e.stopPropagation(); // Prevent click from immediately closing the panel if it's already open
            notificationPanel.classList.toggle('open');
            if (notificationPanel.classList.contains('open')) {
                notificationBadge.style.display = 'none'; // Hide badge when panel is open
            }
        });

        closeNotificationPanelBtn.addEventListener('click', () => {
            notificationPanel.classList.remove('open');
        });

        // Close notification panel if clicked outside
        document.addEventListener('click', (e) => {
            if (!notificationPanel.contains(e.target) && !notificationBell.contains(e.target)) {
                notificationPanel.classList.remove('open');
            }
        });

        // Top Clients Table Sorting Logic
        function renderTopClientsTable() {
            const topClientsTableBody = document.getElementById('top-clients-table-body');
            topClientsTableBody.innerHTML = ''; // Clear existing rows

            // Sort data based on current sort key and direction
            const sortedData = [...dashboardTopClientsData].sort((a, b) => {
                let valA = a[currentTopClientsSortKey];
                let valB = b[currentTopClientsSortKey];

                // Handle string comparison for clientName
                if (typeof valA === 'string') {
                    valA = valA.toLowerCase();
                    valB = valB.toLowerCase();
                }

                if (valA < valB) return currentTopClientsSortDirection === 'asc' ? -1 : 1;
                if (valA > valB) return currentTopClientsSortDirection === 'asc' ? 1 : -1;
                return 0;
            });

            sortedData.forEach(client => {
                const row = `
                    <tr>
                        <td class="px-4 py-3 whitespace-nowrap text-gray-700 dark:text-gray-300">${client.clientName}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-gray-700 dark:text-gray-300">$${(client.aum / 1000000).toFixed(0)}M</td>
                        <td class="px-4 py-3 whitespace-nowrap ${client.netFlows >= 0 ? 'text-green-600' : 'text-red-600'}">${client.netFlows >= 0 ? '+' : ''}${(client.netFlows / 1000000).toFixed(0)}M</td>
                        <td class="px-4 py-3 whitespace-nowrap ${client.performance >= 0 ? 'text-green-600' : 'text-red-600'}">${client.performance >= 0 ? '+' : ''}${client.performance.toFixed(1)}%</td>
                        <td class="px-4 py-3 whitespace-nowrap text-gray-700 dark:text-gray-300">${client.numAccounts}</td>
                    </tr>
                `;
                topClientsTableBody.insertAdjacentHTML('beforeend', row);
            });

            // Update sort icons
            document.querySelectorAll('#dashboard-view th[data-sort-key]').forEach(th => {
                const icon = th.querySelector('i');
                if (icon) {
                    icon.classList.remove('fa-sort', 'fa-sort-up', 'fa-sort-down');
                    if (th.dataset.sortKey === currentTopClientsSortKey) {
                        icon.classList.add(currentTopClientsSortDirection === 'asc' ? 'fa-sort-up' : 'fa-sort-down');
                    } else {
                        icon.classList.add('fa-sort');
                    }
                }
            });
        }

        // Add event listeners for sorting headers
        document.querySelectorAll('#dashboard-view th[data-sort-key]').forEach(header => {
            header.addEventListener('click', function() {
                const sortKey = this.dataset.sortKey;
                if (currentTopClientsSortKey === sortKey) {
                    currentTopClientsSortDirection = currentTopClientsSortDirection === 'asc' ? 'desc' : 'asc';
                } else {
                    currentTopClientsSortKey = sortKey;
                    currentTopClientsSortDirection = 'asc'; // Default to ascending for new sort key
                }
                renderTopClientsTable();
            });
        });
    </script>
</body>
</html>

